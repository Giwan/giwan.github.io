class E{deviceCapabilities;networkCondition;orientationChangeListeners=new Set;networkChangeListeners=new Set;batteryChangeListeners=new Set;isInitialized=!1;constructor(){this.deviceCapabilities=this.detectDeviceCapabilities(),this.networkCondition=this.detectNetworkCondition(),this.initialize()}initialize(){typeof window>"u"||this.isInitialized||(this.setupOrientationChangeHandling(),this.setupNetworkMonitoring(),this.setupBatteryMonitoring(),this.applyOptimizations(),this.isInitialized=!0)}detectDeviceCapabilities(){if(typeof window>"u"||typeof navigator>"u")return{isMobile:!1,isTablet:!1,isPWA:!1,orientation:"portrait",connectionType:"unknown",isLowBattery:!1,hardwareConcurrency:4,deviceMemory:void 0};const e=typeof navigator<"u"?navigator.userAgent.toLowerCase():"",t=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e),i=/ipad|android(?!.*mobile)/i.test(e),n=typeof window<"u"&&window.matchMedia?window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0:!1,r=typeof window<"u"?window.innerHeight>window.innerWidth?"portrait":"landscape":"portrait",o=typeof navigator<"u"&&navigator.hardwareConcurrency||4,d=typeof navigator<"u"?navigator.deviceMemory:void 0,m=(navigator.connection||navigator.mozConnection||navigator.webkitConnection)?.effectiveType||"unknown";return{isMobile:t,isTablet:i,isPWA:n,orientation:r,connectionType:m,isLowBattery:!1,hardwareConcurrency:o,deviceMemory:d}}detectNetworkCondition(){if(typeof window>"u"||typeof navigator>"u")return{effectiveType:"unknown",downlink:10,rtt:100,saveData:!1};const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e?{effectiveType:e.effectiveType||"unknown",downlink:e.downlink||10,rtt:e.rtt||100,saveData:e.saveData||!1}:{effectiveType:"unknown",downlink:10,rtt:100,saveData:!1}}setupOrientationChangeHandling(){const e=()=>{const t=typeof window<"u"?window.innerHeight>window.innerWidth?"portrait":"landscape":"portrait";t!==this.deviceCapabilities.orientation&&(this.deviceCapabilities.orientation=t,this.applyOrientationOptimizations(t),this.orientationChangeListeners.forEach(i=>i()))};typeof window<"u"&&(window.addEventListener("orientationchange",e),window.addEventListener("resize",e)),document.addEventListener("astro:before-preparation",t=>{this.isOrientationChanging()&&this.optimizeForOrientationChange()})}setupNetworkMonitoring(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!e)return;const t=()=>{const i=this.detectNetworkCondition();i.effectiveType!==this.networkCondition.effectiveType&&(this.networkCondition=i,this.applyNetworkOptimizations(i),this.networkChangeListeners.forEach(n=>n(i)))};e&&typeof e.addEventListener=="function"&&e.addEventListener("change",t)}setupBatteryMonitoring(){typeof navigator<"u"&&"getBattery"in navigator&&navigator.getBattery().then(e=>{const t=()=>{const i=e.level<.2||e.charging===!1&&e.level<.3;i!==this.deviceCapabilities.isLowBattery&&(this.deviceCapabilities.isLowBattery=i,this.deviceCapabilities.batteryLevel=e.level,this.applyBatteryOptimizations(i),this.batteryChangeListeners.forEach(n=>n(i)))};t(),e&&typeof e.addEventListener=="function"&&(e.addEventListener("levelchange",t),e.addEventListener("chargingchange",t))}).catch(e=>{console.warn("Battery API not available:",e)})}isOrientationChanging(){const e=typeof window<"u"?window.innerWidth/window.innerHeight:1;return Math.abs(e-1)<.2}applyOrientationOptimizations(e){const t=document.documentElement;t.setAttribute("data-orientation",e),e==="landscape"?t.style.setProperty("--transition-scale-factor","0.8"):t.style.setProperty("--transition-scale-factor","1")}applyNetworkOptimizations(e){const t=document.documentElement;t.setAttribute("data-connection",e.effectiveType),t.setAttribute("data-save-data",e.saveData.toString()),e.effectiveType==="slow-2g"||e.effectiveType==="2g"?(t.style.setProperty("--transition-duration-fast","100ms"),t.style.setProperty("--transition-duration-normal","150ms"),t.style.setProperty("--transition-duration-slow","200ms")):e.effectiveType==="3g"&&(t.style.setProperty("--transition-duration-fast","120ms"),t.style.setProperty("--transition-duration-normal","200ms"),t.style.setProperty("--transition-duration-slow","300ms"))}applyBatteryOptimizations(e){const t=document.documentElement;t.setAttribute("data-battery-low",e.toString()),e&&(t.style.setProperty("--transition-duration-fast","100ms"),t.style.setProperty("--transition-duration-normal","150ms"),t.style.setProperty("--transition-duration-slow","200ms"))}optimizeForOrientationChange(){const e=document.documentElement;e.setAttribute("data-orientation-changing","true"),setTimeout(()=>{e.removeAttribute("data-orientation-changing")},500)}applyOptimizations(){this.applyOrientationOptimizations(this.deviceCapabilities.orientation),this.applyNetworkOptimizations(this.networkCondition),this.applyBatteryOptimizations(this.deviceCapabilities.isLowBattery);const e=document.documentElement;this.deviceCapabilities.isMobile?e.setAttribute("data-device-type","mobile"):this.deviceCapabilities.isTablet?e.setAttribute("data-device-type","tablet"):e.setAttribute("data-device-type","desktop"),this.deviceCapabilities.isPWA&&e.setAttribute("data-pwa","true"),this.deviceCapabilities.hardwareConcurrency<=2&&e.setAttribute("data-low-power","true"),this.deviceCapabilities.deviceMemory&&this.deviceCapabilities.deviceMemory<=2&&e.setAttribute("data-low-memory","true")}getTransitionOptimization(){let e=!1,t="reduce",i=300,n="cubic-bezier(0.4, 0.0, 0.2, 1)";return this.deviceCapabilities.isLowBattery&&(e=!0,t="simplify",i=150),(this.networkCondition.effectiveType==="slow-2g"||this.networkCondition.effectiveType==="2g")&&(e=!0,t="simplify",i=100),this.deviceCapabilities.hardwareConcurrency<=2&&(e=!0,t="reduce",i=200),this.deviceCapabilities.isPWA&&(i=Math.max(i*.9,100),n="cubic-bezier(0.2, 0, 0, 1)"),this.deviceCapabilities.isMobile&&(n="cubic-bezier(0.25, 0.46, 0.45, 0.94)"),{shouldOptimize:e,optimizationType:t,recommendedDuration:i,recommendedEasing:n}}onOrientationChange(e){return this.orientationChangeListeners.add(e),()=>{this.orientationChangeListeners.delete(e)}}onNetworkChange(e){return this.networkChangeListeners.add(e),()=>{this.networkChangeListeners.delete(e)}}onBatteryChange(e){return this.batteryChangeListeners.add(e),()=>{this.batteryChangeListeners.delete(e)}}getDeviceCapabilities(){return{...this.deviceCapabilities}}getNetworkCondition(){return{...this.networkCondition}}canHandleComplexTransitions(){return!this.deviceCapabilities.isLowBattery&&this.networkCondition.effectiveType!=="slow-2g"&&this.networkCondition.effectiveType!=="2g"&&this.deviceCapabilities.hardwareConcurrency>2}getPWATransitionSettings(){return this.deviceCapabilities.isPWA?{duration:this.getTransitionOptimization().recommendedDuration,easing:"cubic-bezier(0.2, 0, 0, 1)"}:{duration:300,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}}destroy(){this.orientationChangeListeners.clear(),this.networkChangeListeners.clear(),this.batteryChangeListeners.clear(),this.isInitialized=!1}}const p=new E;class T{pwaState;serviceWorkerRegistration=null;transitionQueue=[];isInitialized=!1;constructor(){this.pwaState={isOnline:typeof navigator<"u"?navigator.onLine:!0,isInstalled:this.detectPWAInstallation(),serviceWorkerReady:!1,hasUpdate:!1,isBackground:typeof document<"u"?document.visibilityState==="hidden":!1},this.initialize()}async initialize(){typeof window>"u"||this.isInitialized||(await this.setupServiceWorkerIntegration(),this.setupNetworkHandling(),this.setupAppLifecycleHandling(),this.setupPWATransitionBehaviors(),this.isInitialized=!0)}detectPWAInstallation(){return typeof window>"u"||typeof document>"u"?!1:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||(typeof document<"u"&&document.referrer?document.referrer.includes("android-app://"):!1)}async setupServiceWorkerIntegration(){if("serviceWorker"in navigator)try{this.serviceWorkerRegistration=await navigator.serviceWorker.ready,this.pwaState.serviceWorkerReady=!0,navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this)),this.serviceWorkerRegistration.addEventListener("updatefound",()=>{this.pwaState.hasUpdate=!0,this.handleServiceWorkerUpdate()}),this.serviceWorkerRegistration.installing&&this.trackServiceWorkerState(this.serviceWorkerRegistration.installing),this.serviceWorkerRegistration.waiting&&(this.pwaState.hasUpdate=!0)}catch(e){console.warn("Failed to set up service worker integration:",e)}}trackServiceWorkerState(e){e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(this.pwaState.hasUpdate=!0,this.handleServiceWorkerUpdate())})}handleServiceWorkerMessage(e){const{type:t,data:i}=e.data;switch(t){case"TRANSITION_CACHE_READY":this.handleTransitionCacheReady(i);break;case"OFFLINE_FALLBACK":this.handleOfflineFallback(i);break;case"CACHE_UPDATE":this.handleCacheUpdate(i);break}}handleServiceWorkerUpdate(){const e=document.documentElement;e.setAttribute("data-sw-updating","true"),window.dispatchEvent(new CustomEvent("pwa-update-available",{detail:{registration:this.serviceWorkerRegistration}})),setTimeout(()=>{e.removeAttribute("data-sw-updating")},2e3)}setupNetworkHandling(){const e=()=>{this.pwaState.isOnline=!0,this.handleNetworkStateChange(!0)},t=()=>{this.pwaState.isOnline=!1,this.handleNetworkStateChange(!1)};window.addEventListener("online",e),window.addEventListener("offline",t)}handleNetworkStateChange(e){const t=document.documentElement;if(t.setAttribute("data-network-state",e?"online":"offline"),!e)t.setAttribute("data-offline-mode","true"),t.style.setProperty("--transition-duration-fast","100ms"),t.style.setProperty("--transition-duration-normal","150ms"),t.style.setProperty("--transition-duration-slow","200ms");else{t.removeAttribute("data-offline-mode");const i=p.getTransitionOptimization();t.style.setProperty("--transition-duration-normal",`${i.recommendedDuration}ms`)}window.dispatchEvent(new CustomEvent("pwa-network-change",{detail:{isOnline:e,timestamp:Date.now()}}))}setupAppLifecycleHandling(){document.addEventListener("visibilitychange",()=>{const e=document.visibilityState==="hidden";this.pwaState.isBackground=e,this.handleAppStateChange(e)}),window.addEventListener("focus",()=>{this.handleAppFocus()}),window.addEventListener("blur",()=>{this.handleAppBlur()}),window.addEventListener("beforeinstallprompt",e=>{this.handleInstallPrompt(e)}),window.addEventListener("appinstalled",()=>{this.pwaState.isInstalled=!0,this.handleAppInstalled()})}handleAppStateChange(e){const t=document.documentElement;t.setAttribute("data-app-state",e?"background":"foreground"),e?t.setAttribute("data-transitions-paused","true"):(t.removeAttribute("data-transitions-paused"),this.processQueuedTransitions())}handleAppFocus(){document.documentElement.removeAttribute("data-app-unfocused"),this.processQueuedTransitions()}handleAppBlur(){document.documentElement.setAttribute("data-app-unfocused","true")}handleInstallPrompt(e){window.deferredPrompt=e,window.dispatchEvent(new CustomEvent("pwa-install-available",{detail:{event:e}}))}handleAppInstalled(){const e=document.documentElement;e.setAttribute("data-pwa-installed","true");const t=p.getPWATransitionSettings();e.style.setProperty("--transition-duration-normal",`${t.duration}ms`),e.style.setProperty("--transition-easing-standard",t.easing),window.dispatchEvent(new CustomEvent("pwa-installed",{detail:{timestamp:Date.now()}}))}setupPWATransitionBehaviors(){document.addEventListener("astro:before-preparation",e=>{this.handleTransitionStart(e)}),document.addEventListener("astro:after-swap",e=>{this.handleTransitionComplete(e)}),this.pwaState.isInstalled&&this.applyPWATransitionOptimizations()}handleTransitionStart(e){const t=window.location.href,i=e.detail?.to?.href||t,n={fromUrl:t,toUrl:i,transitionType:this.detectTransitionType(t,i),timestamp:Date.now(),userAgent:navigator.userAgent};this.transitionQueue.push(n),this.serviceWorkerRegistration?.active&&this.serviceWorkerRegistration.active.postMessage({type:"TRANSITION_START",data:n}),this.applyTransitionOptimizations(n)}handleTransitionComplete(e){const t=this.transitionQueue.pop();t&&this.serviceWorkerRegistration?.active&&this.serviceWorkerRegistration.active.postMessage({type:"TRANSITION_COMPLETE",data:{...t,completedAt:Date.now(),duration:Date.now()-t.timestamp}})}detectTransitionType(e,t){const i=new URL(e).pathname,n=new URL(t).pathname;return i===n?"refresh":n.includes(i)?"drill-down":i.includes(n)?"drill-up":"navigation"}applyPWATransitionOptimizations(){const e=document.documentElement;e.setAttribute("data-pwa","true");const t=p.getPWATransitionSettings();e.style.setProperty("--transition-duration-pwa",`${t.duration}ms`),e.style.setProperty("--transition-easing-pwa",t.easing)}applyTransitionOptimizations(e){const t=document.documentElement;this.pwaState.isOnline||t.setAttribute("data-offline-transition","true"),this.pwaState.hasUpdate&&t.setAttribute("data-sw-update-pending","true"),this.pwaState.isBackground&&t.setAttribute("data-background-transition","true")}handleTransitionCacheReady(e){document.documentElement.setAttribute("data-cache-ready","true")}handleOfflineFallback(e){const t=document.documentElement;t.setAttribute("data-offline-fallback","true"),t.style.setProperty("--transition-duration-fast","50ms"),t.style.setProperty("--transition-duration-normal","100ms")}handleCacheUpdate(e){const t=document.documentElement;t.setAttribute("data-cache-updating","true"),setTimeout(()=>{t.removeAttribute("data-cache-updating")},1e3)}processQueuedTransitions(){this.transitionQueue.length>0&&this.serviceWorkerRegistration?.active&&(this.transitionQueue.forEach(e=>{this.serviceWorkerRegistration.active.postMessage({type:"QUEUED_TRANSITION",data:e})}),this.transitionQueue=[])}getPWAState(){return{...this.pwaState}}shouldApplyPWAOptimizations(){return this.pwaState.isInstalled&&this.pwaState.serviceWorkerReady}getPWATransitionSettings(){return{...p.getPWATransitionSettings(),shouldOptimize:this.shouldApplyPWAOptimizations()}}async triggerInstallPrompt(){const e=window.deferredPrompt;if(!e)return!1;try{e.prompt();const{outcome:t}=await e.userChoice;return t==="accepted"&&(this.pwaState.isInstalled=!0,this.applyPWATransitionOptimizations()),window.deferredPrompt=null,t==="accepted"}catch(t){return console.warn("Failed to trigger install prompt:",t),!1}}destroy(){this.transitionQueue=[],this.isInitialized=!1}}const A=new T;var s=(a=>(a.MINIMAL="minimal",a.REDUCED="reduced",a.NORMAL="normal",a.ENHANCED="enhanced",a))(s||{});class k{frameRateHistory=[];transitionHistory=[];currentTransitionData=null;frameRateObserver=null;performanceObserver=null;isMonitoring=!1;FRAME_RATE_THRESHOLD=30;DROPPED_FRAME_THRESHOLD=5;MEMORY_THRESHOLD=.8;constructor(){this.initialize()}initialize(){typeof window>"u"||(this.setupFrameRateMonitoring(),this.setupPerformanceObserver(),this.setupTransitionEventListeners())}setupFrameRateMonitoring(){let e=performance.now(),t=0;const i=n=>{if(this.isMonitoring){const r=n-e,o=1e3/r;t++,this.currentTransitionData&&(this.currentTransitionData.frameCount=t,r>16.67&&(this.currentTransitionData.droppedFrames=(this.currentTransitionData.droppedFrames||0)+1),(!this.currentTransitionData.worstFrameTime||r>this.currentTransitionData.worstFrameTime)&&(this.currentTransitionData.worstFrameTime=r)),this.frameRateHistory.push(o),this.frameRateHistory.length>100&&this.frameRateHistory.shift()}e=n,requestAnimationFrame(i)};requestAnimationFrame(i)}setupPerformanceObserver(){if("PerformanceObserver"in window)try{this.performanceObserver=new PerformanceObserver(e=>{e.getEntries().forEach(i=>{i.entryType==="navigation"&&this.handleNavigationTiming(i),i.entryType==="paint"&&this.handlePaintTiming(i),i.entryType==="layout-shift"&&this.handleLayoutShift(i)})}),this.performanceObserver.observe({entryTypes:["navigation","paint","layout-shift"]})}catch(e){console.warn("Performance Observer not fully supported:",e)}}setupTransitionEventListeners(){document.addEventListener("astro:before-preparation",this.handleTransitionStart.bind(this)),document.addEventListener("astro:after-swap",this.handleTransitionEnd.bind(this)),document.addEventListener("astro:page-load",this.handlePageLoad.bind(this))}handleTransitionStart(e){const t=e,i=this.getTransitionType(t);this.startMonitoring(i)}handleTransitionEnd(e){this.stopMonitoring()}handlePageLoad(e){this.stopMonitoring()}startMonitoring(e="unknown"){this.isMonitoring&&this.stopMonitoring(),this.isMonitoring=!0,this.currentTransitionData={startTime:performance.now(),frameCount:0,droppedFrames:0,transitionType:e,deviceInfo:this.getDeviceCapabilities()}}stopMonitoring(){if(!this.isMonitoring||!this.currentTransitionData)return null;this.isMonitoring=!1;const e=performance.now(),t=e-(this.currentTransitionData.startTime??0),i=this.currentTransitionData.frameCount||0,n=i>0?i/(t/1e3):0,r={...this.currentTransitionData,endTime:e,averageFrameRate:n};return this.transitionHistory.push(r),this.transitionHistory.length>50&&this.transitionHistory.shift(),this.checkPerformanceAndTriggerFallback(r),this.currentTransitionData=null,r}getCurrentMetrics(){const e=this.frameRateHistory.slice(-30),t=e.length>0?e.reduce((r,o)=>r+o,0)/e.length:60,i=1e3/t,n=this.currentTransitionData?.droppedFrames||0;return{frameRate:Math.round(t),averageFrameTime:Math.round(i*100)/100,droppedFrames:n,transitionDuration:this.currentTransitionData?performance.now()-(this.currentTransitionData.startTime??0):0,memoryUsage:this.getMemoryUsage(),cpuUsage:this.getCPUUsage()}}getDeviceCapabilities(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return{hardwareConcurrency:navigator.hardwareConcurrency||4,deviceMemory:navigator.deviceMemory,connectionType:e?.effectiveType||"unknown",isLowPowerMode:this.detectLowPowerMode(),prefersReducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches}}detectLowPowerMode(){return[navigator.hardwareConcurrency<=2,navigator.deviceMemory&&navigator.deviceMemory<=2,window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.getAverageFrameRate()<45].filter(Boolean).length>=2}getMemoryUsage(){if("memory"in performance){const e=performance.memory;return e.usedJSHeapSize/e.jsHeapSizeLimit}}getCPUUsage(){if(this.frameRateHistory.length<10)return;const e=this.frameRateHistory.slice(-10),t=e.reduce((n,r)=>n+r,0)/e.length,i=Math.max(0,Math.min(1,(60-t)/30));return Math.round(i*100)/100}getAverageFrameRate(){if(this.frameRateHistory.length===0)return 60;const e=this.frameRateHistory.slice(-20);return e.reduce((t,i)=>t+i,0)/e.length}checkPerformanceAndTriggerFallback(e){(e.averageFrameRate<this.FRAME_RATE_THRESHOLD||e.droppedFrames>this.DROPPED_FRAME_THRESHOLD||(this.getMemoryUsage()||0)>this.MEMORY_THRESHOLD)&&this.triggerPerformanceFallback(e)}triggerPerformanceFallback(e){const t=document.documentElement;t.setAttribute("data-performance-mode","low"),t.setAttribute("data-transition-fallback","true");const i=new CustomEvent("transition-performance-fallback",{detail:{performanceData:e,recommendedIntensity:this.getRecommendedIntensity(e)}});document.dispatchEvent(i),setTimeout(()=>{t.removeAttribute("data-transition-fallback"),this.getAverageFrameRate()>this.FRAME_RATE_THRESHOLD+10&&t.setAttribute("data-performance-mode","normal")},5e3)}getRecommendedIntensity(e){const t=e||this.getCurrentMetrics(),i=this.getDeviceCapabilities();if(i.prefersReducedMotion)return"minimal";if(i.isLowPowerMode||i.hardwareConcurrency<=2||i.deviceMemory&&i.deviceMemory<=2)return"reduced";const n="frameRate"in t?t.frameRate:t.averageFrameRate,r="droppedFrames"in t?t.droppedFrames:0;return n<30||r>5?"reduced":n<45||r>2?"normal":n>=55&&i.hardwareConcurrency>=8&&(!i.deviceMemory||i.deviceMemory>=8)?"enhanced":"normal"}getTransitionType(e){const t=e.detail?.from?.pathname||"",i=e.detail?.to?.pathname||"";return t.includes("/blog")&&i.includes("/blog")?"blog-navigation":t.includes("/tools")&&i.includes("/tools")?"tools-navigation":t==="/"||i==="/"?"home-navigation":"general-navigation"}handleNavigationTiming(e){this.currentTransitionData&&this.currentTransitionData.deviceInfo}handlePaintTiming(e){this.isMonitoring&&e.name}handleLayoutShift(e){this.isMonitoring&&e.value>.1&&console.warn("Layout shift detected during transition:",e.value)}getPerformanceHistory(){return[...this.transitionHistory]}clearHistory(){this.transitionHistory=[],this.frameRateHistory=[]}destroy(){this.isMonitoring=!1,this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=null),document.removeEventListener("astro:before-preparation",this.handleTransitionStart.bind(this)),document.removeEventListener("astro:after-swap",this.handleTransitionEnd.bind(this)),document.removeEventListener("astro:page-load",this.handlePageLoad.bind(this))}}const h=new k;class M{preferences;STORAGE_KEY="transition-preferences";DEFAULT_PREFERENCES={intensity:s.NORMAL,respectReducedMotion:!0,adaptToPerformance:!0,enableSoundEffects:!1,enableHapticFeedback:!1,debugMode:!1};changeListeners=[];mediaQueryList=null;constructor(){this.preferences=this.loadPreferences(),this.initialize()}initialize(){typeof window>"u"||(this.setupReducedMotionListener(),this.applyPreferences(),this.preferences.adaptToPerformance&&this.setupPerformanceAdaptation())}setupReducedMotionListener(){if(!window.matchMedia)return;this.mediaQueryList=window.matchMedia("(prefers-reduced-motion: reduce)");const e=t=>{if(this.preferences.respectReducedMotion){const i=t.matches?s.MINIMAL:s.NORMAL;this.updatePreference("intensity",i)}};this.mediaQueryList.addEventListener?this.mediaQueryList.addEventListener("change",e):this.mediaQueryList.addListener(e)}setupPerformanceAdaptation(){document.addEventListener("transition-performance-fallback",e=>{const i=e.detail?.recommendedIntensity;i&&this.preferences.adaptToPerformance&&this.updatePreference("intensity",i)})}loadPreferences(){if(typeof localStorage>"u")return{...this.DEFAULT_PREFERENCES};try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);return{...this.DEFAULT_PREFERENCES,...t}}}catch(e){console.warn("Failed to load transition preferences:",e)}return{...this.DEFAULT_PREFERENCES}}savePreferences(){if(!(typeof localStorage>"u"))try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.preferences))}catch(e){console.warn("Failed to save transition preferences:",e)}}getPreferences(){return{...this.preferences}}getPreference(e){return this.preferences[e]}updatePreference(e,t){const i=this.preferences[e];if(i===t)return;this.preferences[e]=t,this.savePreferences(),this.applyPreferences();const n={preference:e,oldValue:i,newValue:t,timestamp:Date.now()};this.changeListeners.forEach(r=>{try{r(n)}catch(o){console.warn("Error in preference change listener:",o)}})}updatePreferences(e){const t=[];Object.entries(e).forEach(([i,n])=>{const r=i,o=this.preferences[r];o!==n&&(this.preferences[r]=n,t.push({preference:r,oldValue:o,newValue:n,timestamp:Date.now()}))}),t.length>0&&(this.savePreferences(),this.applyPreferences(),t.forEach(i=>{this.changeListeners.forEach(n=>{try{n(i)}catch(r){console.warn("Error in preference change listener:",r)}})}))}resetPreferences(){const e={...this.preferences};this.preferences={...this.DEFAULT_PREFERENCES},this.savePreferences(),this.applyPreferences(),Object.keys(this.preferences).forEach(t=>{const i=t,n=e[i],r=this.preferences[i];if(n!==r){const o={preference:i,oldValue:n,newValue:r,timestamp:Date.now()};this.changeListeners.forEach(d=>{try{d(o)}catch(u){console.warn("Error in preference change listener:",u)}})}})}applyPreferences(){if(typeof document>"u")return;const e=document.documentElement;e.setAttribute("data-transition-intensity",this.preferences.intensity),this.preferences.respectReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches?e.setAttribute("data-reduced-motion","true"):e.removeAttribute("data-reduced-motion"),e.setAttribute("data-adapt-performance",this.preferences.adaptToPerformance.toString()),this.preferences.customDuration?e.style.setProperty("--transition-duration-custom",`${this.preferences.customDuration}ms`):e.style.removeProperty("--transition-duration-custom"),this.preferences.debugMode?e.setAttribute("data-debug-transitions","true"):e.removeAttribute("data-debug-transitions"),e.setAttribute("data-sound-effects",this.preferences.enableSoundEffects.toString()),e.setAttribute("data-haptic-feedback",this.preferences.enableHapticFeedback.toString()),this.applyCSSProperties()}applyCSSProperties(){const e=document.documentElement;switch(this.preferences.intensity){case s.MINIMAL:e.style.setProperty("--transition-duration-multiplier","0"),e.style.setProperty("--transition-scale-factor","0"),e.style.setProperty("--transition-opacity-factor","1");break;case s.REDUCED:e.style.setProperty("--transition-duration-multiplier","0.5"),e.style.setProperty("--transition-scale-factor","0.5"),e.style.setProperty("--transition-opacity-factor","0.8");break;case s.NORMAL:e.style.setProperty("--transition-duration-multiplier","1"),e.style.setProperty("--transition-scale-factor","1"),e.style.setProperty("--transition-opacity-factor","1");break;case s.ENHANCED:e.style.setProperty("--transition-duration-multiplier","1.2"),e.style.setProperty("--transition-scale-factor","1.2"),e.style.setProperty("--transition-opacity-factor","1");break}}getEffectiveIntensity(){if(this.preferences.respectReducedMotion&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return s.MINIMAL;if(this.preferences.adaptToPerformance){const e=h.getRecommendedIntensity(),t=[s.MINIMAL,s.REDUCED,s.NORMAL,s.ENHANCED],i=t.indexOf(this.preferences.intensity),n=t.indexOf(e);return t[Math.min(i,n)]}return this.preferences.intensity}addChangeListener(e){this.changeListeners.push(e)}removeChangeListener(e){const t=this.changeListeners.indexOf(e);t>-1&&this.changeListeners.splice(t,1)}createIntensityControl(){const e=document.createElement("div");e.className="transition-intensity-control",e.innerHTML=`
      <label for="transition-intensity">Transition Intensity:</label>
      <select id="transition-intensity" class="transition-intensity-select">
        <option value="${s.MINIMAL}">Minimal</option>
        <option value="${s.REDUCED}">Reduced</option>
        <option value="${s.NORMAL}">Normal</option>
        <option value="${s.ENHANCED}">Enhanced</option>
      </select>
    `;const t=e.querySelector("select");return t.value=this.preferences.intensity,t.addEventListener("change",i=>{const n=i.target;this.updatePreference("intensity",n.value)}),this.addChangeListener(i=>{i.preference==="intensity"&&(t.value=i.newValue)}),e}createPreferencesPanel(){const e=document.createElement("div");e.className="transition-preferences-panel",e.innerHTML=`
      <h3>Transition Preferences</h3>
      
      <div class="preference-group">
        <label for="intensity-select">Intensity:</label>
        <select id="intensity-select">
          <option value="${s.MINIMAL}">Minimal</option>
          <option value="${s.REDUCED}">Reduced</option>
          <option value="${s.NORMAL}">Normal</option>
          <option value="${s.ENHANCED}">Enhanced</option>
        </select>
      </div>
      
      <div class="preference-group">
        <label>
          <input type="checkbox" id="respect-reduced-motion"> 
          Respect reduced motion preference
        </label>
      </div>
      
      <div class="preference-group">
        <label>
          <input type="checkbox" id="adapt-performance"> 
          Adapt to device performance
        </label>
      </div>
      
      <div class="preference-group">
        <label for="custom-duration">Custom duration (ms):</label>
        <input type="number" id="custom-duration" min="0" max="2000" step="50">
      </div>
      
      <div class="preference-group">
        <label>
          <input type="checkbox" id="sound-effects"> 
          Enable sound effects
        </label>
      </div>
      
      <div class="preference-group">
        <label>
          <input type="checkbox" id="haptic-feedback"> 
          Enable haptic feedback
        </label>
      </div>
      
      <div class="preference-group">
        <label>
          <input type="checkbox" id="debug-mode"> 
          Debug mode
        </label>
      </div>
      
      <div class="preference-actions">
        <button id="reset-preferences">Reset to Defaults</button>
      </div>
    `;const t=e.querySelector("#intensity-select"),i=e.querySelector("#respect-reduced-motion"),n=e.querySelector("#adapt-performance"),r=e.querySelector("#custom-duration"),o=e.querySelector("#sound-effects"),d=e.querySelector("#haptic-feedback"),u=e.querySelector("#debug-mode"),m=e.querySelector("#reset-preferences");return t.value=this.preferences.intensity,i.checked=this.preferences.respectReducedMotion,n.checked=this.preferences.adaptToPerformance,r.value=this.preferences.customDuration?.toString()||"",o.checked=this.preferences.enableSoundEffects,d.checked=this.preferences.enableHapticFeedback,u.checked=this.preferences.debugMode,t.addEventListener("change",l=>{const c=l.target;this.updatePreference("intensity",c.value)}),i.addEventListener("change",l=>{const c=l.target;this.updatePreference("respectReducedMotion",c.checked)}),n.addEventListener("change",l=>{const c=l.target;this.updatePreference("adaptToPerformance",c.checked)}),r.addEventListener("change",l=>{const c=l.target,w=c.value?parseInt(c.value):void 0;this.updatePreference("customDuration",w)}),o.addEventListener("change",l=>{const c=l.target;this.updatePreference("enableSoundEffects",c.checked)}),d.addEventListener("change",l=>{const c=l.target;this.updatePreference("enableHapticFeedback",c.checked)}),u.addEventListener("change",l=>{const c=l.target;this.updatePreference("debugMode",c.checked)}),m.addEventListener("click",()=>{this.resetPreferences()}),e}destroy(){this.mediaQueryList&&(this.mediaQueryList.removeEventListener?this.mediaQueryList.removeEventListener("change",()=>{}):this.mediaQueryList.removeListener(()=>{}),this.mediaQueryList=null),this.changeListeners=[]}}const f=new M;class C{errorHistory=[];fallbackOptions={useAstroBuiltIn:!0,disableAnimations:!1,enableDebugMode:!1,timeoutMs:5e3};isInitialized=!1;debugMode=!1;transitionTimeouts=new Map;constructor(){this.initialize()}initialize(){typeof window>"u"||this.isInitialized||(this.debugMode=this.isDevMode()||this.fallbackOptions.enableDebugMode,this.setupErrorListeners(),this.setupAstroEventListeners(),this.setupGlobalErrorHandlers(),this.isInitialized=!0,this.debugMode&&console.log("[TransitionErrorHandler] Initialized with debug mode enabled"))}setupErrorListeners(){window.addEventListener("unhandledrejection",e=>{this.isTransitionRelatedError(e.reason)&&(this.handleTransitionError({type:"unknown",message:"Unhandled promise rejection during transition",originalError:e.reason,context:{timestamp:Date.now(),userAgent:navigator.userAgent}}),e.preventDefault())}),window.addEventListener("error",e=>{this.isTransitionRelatedError(e.error)&&this.handleTransitionError({type:"unknown",message:e.message||"Unknown transition error",originalError:e.error,context:{timestamp:Date.now(),userAgent:navigator.userAgent}})})}setupAstroEventListeners(){document.addEventListener("astro:before-preparation",e=>{const t=e,i=t.detail?.from?.pathname||window.location.pathname,n=t.detail?.to?.pathname||"unknown";try{const r=setTimeout(()=>{this.handleTransitionError({type:"timeout",message:"Transition preparation timed out",context:{fromPath:i,toPath:n,timestamp:Date.now(),userAgent:navigator.userAgent}})},this.fallbackOptions.timeoutMs);this.transitionTimeouts.set(`${i}->${n}`,r),this.isViewTransitionSupported()||this.handleApiUnsupported(i,n),this.debugMode&&console.log("[TransitionErrorHandler] Transition preparation started",{from:i,to:n,apiSupported:this.isViewTransitionSupported()})}catch(r){this.handleTransitionError({type:"preparation-failed",message:"Failed during transition preparation",originalError:r,context:{fromPath:i,toPath:n,timestamp:Date.now(),userAgent:navigator.userAgent}})}}),document.addEventListener("astro:after-swap",e=>{const t=e,i=t.detail?.from?.pathname||"unknown",n=t.detail?.to?.pathname||window.location.pathname,r=`${i}->${n}`,o=this.transitionTimeouts.get(r);o&&(clearTimeout(o),this.transitionTimeouts.delete(r)),this.debugMode&&console.log("[TransitionErrorHandler] Transition completed successfully",{from:i,to:n})}),document.addEventListener("astro:page-load",()=>{this.transitionTimeouts.forEach(e=>{clearTimeout(e)}),this.transitionTimeouts.clear(),this.debugMode&&console.log("[TransitionErrorHandler] Page load completed")})}setupGlobalErrorHandlers(){const e=console.error;console.error=(...t)=>{const i=t.join(" ");this.isTransitionRelatedError(i)&&this.handleTransitionError({type:"unknown",message:i,context:{timestamp:Date.now(),userAgent:navigator.userAgent}}),e.apply(console,t)}}isViewTransitionSupported(){return typeof document<"u"&&"startViewTransition"in document}handleApiUnsupported(e,t){const i={type:"api-unsupported",message:"View Transition API is not supported in this browser",context:{fromPath:e,toPath:t,timestamp:Date.now(),userAgent:navigator.userAgent}};this.handleTransitionError(i),this.enableFallbackMode()}handleTransitionError(e){this.errorHistory.push(e),this.errorHistory.length>50&&this.errorHistory.shift(),this.debugMode&&console.error("[TransitionErrorHandler] Transition error:",e),this.applyErrorFallback(e);const t=new CustomEvent("transition-error",{detail:e});document.dispatchEvent(t)}applyErrorFallback(e){const t=document.documentElement;switch(e.type){case"api-unsupported":this.enableFallbackMode(),t.setAttribute("data-transition-fallback-reason","api-unsupported");break;case"preparation-failed":this.enableAstroBuiltInTransitions(),t.setAttribute("data-transition-fallback-reason","preparation-failed");break;case"transition-failed":this.enableAstroBuiltInTransitions(),t.setAttribute("data-transition-fallback-reason","transition-failed");break;case"timeout":this.enableAstroBuiltInTransitions(),t.setAttribute("data-transition-fallback-reason","timeout");break;default:this.enableFallbackMode(),t.setAttribute("data-transition-fallback-reason","unknown");break}t.setAttribute("data-transition-error","true"),t.setAttribute("data-transition-error-type",e.type),setTimeout(()=>{this.attemptRecovery()},1e4)}enableFallbackMode(){const e=document.documentElement;e.setAttribute("data-transition-fallback","true"),e.setAttribute("data-view-transition-disabled","true"),e.style.setProperty("--disable-view-transitions","1"),this.debugMode&&console.log("[TransitionErrorHandler] Fallback mode enabled")}enableAstroBuiltInTransitions(){const e=document.documentElement;e.setAttribute("data-astro-transitions-only","true"),e.setAttribute("data-view-transition-fallback","astro"),e.style.setProperty("--transition-duration","200ms"),e.style.setProperty("--transition-easing","ease-out"),this.debugMode&&console.log("[TransitionErrorHandler] Astro built-in transitions enabled")}attemptRecovery(){const e=document.documentElement;this.errorHistory.filter(i=>Date.now()-i.context.timestamp<3e4).length===0&&this.isViewTransitionSupported()&&(e.removeAttribute("data-transition-error"),e.removeAttribute("data-transition-error-type"),e.removeAttribute("data-transition-fallback-reason"),e.removeAttribute("data-transition-fallback"),e.removeAttribute("data-view-transition-disabled"),e.removeAttribute("data-astro-transitions-only"),e.removeAttribute("data-view-transition-fallback"),e.style.removeProperty("--disable-view-transitions"),e.style.removeProperty("--transition-duration"),e.style.removeProperty("--transition-easing"),this.debugMode&&console.log("[TransitionErrorHandler] Recovery attempted"))}isTransitionRelatedError(e){if(!e)return!1;const t=typeof e=="string"?e:e.message||e.toString();return["view-transition","startViewTransition","astro:before-preparation","astro:after-swap","transition-name","view-transition-name"].some(n=>t.toLowerCase().includes(n.toLowerCase()))}getDebugInfo(){return{apiSupported:this.isViewTransitionSupported(),currentPath:window.location.pathname,transitionInProgress:this.transitionTimeouts.size>0,errorHistory:[...this.errorHistory],performanceMetrics:this.getPerformanceMetrics(),deviceCapabilities:this.getDeviceCapabilities()}}getPerformanceMetrics(){try{const e=window.performanceMonitor;if(e&&typeof e.getCurrentMetrics=="function")return e.getCurrentMetrics()}catch{}return{memory:performance.memory?{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit}:null,timing:performance.timing?{navigationStart:performance.timing.navigationStart,loadEventEnd:performance.timing.loadEventEnd,domContentLoaded:performance.timing.domContentLoadedEventEnd}:null}}getDeviceCapabilities(){try{const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return{userAgent:navigator?.userAgent||"unknown",hardwareConcurrency:navigator?.hardwareConcurrency||4,deviceMemory:navigator?.deviceMemory,connectionType:e?.effectiveType||"unknown",prefersReducedMotion:window?.matchMedia?window.matchMedia("(prefers-reduced-motion: reduce)").matches:!1,viewportSize:{width:window?.innerWidth||1024,height:window?.innerHeight||768}}}catch{return{userAgent:"unknown",hardwareConcurrency:4,deviceMemory:void 0,connectionType:"unknown",prefersReducedMotion:!1,viewportSize:{width:1024,height:768}}}}enableDebugMode(){this.debugMode=!0,this.fallbackOptions.enableDebugMode=!0,document.documentElement.setAttribute("data-transition-debug","true"),console.log("[TransitionErrorHandler] Debug mode enabled"),console.log("[TransitionErrorHandler] Current debug info:",this.getDebugInfo())}disableDebugMode(){this.debugMode=!1,this.fallbackOptions.enableDebugMode=!1,document.documentElement.removeAttribute("data-transition-debug"),console.log("[TransitionErrorHandler] Debug mode disabled")}getErrorHistory(){return[...this.errorHistory]}clearErrorHistory(){this.errorHistory=[],this.debugMode&&console.log("[TransitionErrorHandler] Error history cleared")}updateFallbackOptions(e){this.fallbackOptions={...this.fallbackOptions,...e},e.enableDebugMode!==void 0&&(e.enableDebugMode?this.enableDebugMode():this.disableDebugMode()),this.debugMode&&console.log("[TransitionErrorHandler] Fallback options updated:",this.fallbackOptions)}forceFallback(e="manual"){this.handleTransitionError({type:"unknown",message:`Fallback forced: ${e}`,context:{timestamp:Date.now(),userAgent:navigator.userAgent}})}testErrorHandling(){if(!this.debugMode){console.warn("[TransitionErrorHandler] Test methods only available in debug mode");return}console.log("[TransitionErrorHandler] Testing error handling..."),setTimeout(()=>{this.handleApiUnsupported("/test-from","/test-to")},1e3),setTimeout(()=>{this.handleTransitionError({type:"preparation-failed",message:"Test preparation failure",context:{fromPath:"/test-from",toPath:"/test-to",timestamp:Date.now(),userAgent:navigator.userAgent}})},2e3),setTimeout(()=>{this.handleTransitionError({type:"timeout",message:"Test timeout",context:{fromPath:"/test-from",toPath:"/test-to",timestamp:Date.now(),userAgent:navigator.userAgent}})},3e3)}isDevMode(){try{return globalThis.import?.meta?.env?.DEV||process?.env?.NODE_ENV==="development"||!1}catch{return!1}}destroy(){this.transitionTimeouts.forEach(e=>{clearTimeout(e)}),this.transitionTimeouts.clear(),this.isInitialized=!1,this.debugMode&&console.log("[TransitionErrorHandler] Destroyed")}}new C;var y=(a=>(a.HOME="home",a.BLOG_LIST="blog-list",a.BLOG_POST="blog-post",a.TOOLS_LIST="tools-list",a.TOOLS_CATEGORY="tools-category",a.SEARCH="search",a.ABOUT="about",a.CONTACT="contact",a.OFFLINE="offline",a.UNKNOWN="unknown",a))(y||{}),v=(a=>(a.FORWARD="forward",a.BACKWARD="backward",a.REFRESH="refresh",a))(v||{}),b=(a=>(a.SIBLING="sibling",a.PARENT_CHILD="parent-child",a.CHILD_PARENT="child-parent",a.UNRELATED="unrelated",a.CONTEXTUAL="contextual",a))(b||{});class g{navigationHistory=[];currentPath="";metrics={averageDuration:0,failureRate:0,totalTransitions:0,lastTransitionTime:0};isInitialized=!1;transitionInProgress=!1;constructor(){this.initialize()}initialize(){typeof window>"u"||this.isInitialized||(this.currentPath=window.location.pathname,this.navigationHistory=[this.currentPath],document.addEventListener("astro:before-preparation",this.handleBeforePreparation.bind(this)),document.addEventListener("astro:after-swap",this.handleAfterSwap.bind(this)),document.addEventListener("astro:page-load",this.handlePageLoad.bind(this)),window.addEventListener("popstate",this.handlePopState.bind(this)),this.isInitialized=!0)}detectNavigationContext(e,t){const i=this.detectNavigationDirection(e,t),n=this.classifyPageType(e),r=this.classifyPageType(t),o=this.analyzePageRelationship(n,r,e,t);return{direction:i,fromPageType:n,toPageType:r,relationship:o,fromPath:e,toPath:t,timestamp:Date.now()}}detectNavigationDirection(e,t){if(e===t)return"refresh";const i=this.navigationHistory.lastIndexOf(e),n=this.navigationHistory.lastIndexOf(t);return n!==-1&&n<i||this.isBackwardNavigation(e,t)?"backward":"forward"}isBackwardNavigation(e,t){return e.includes(t)&&e!==t||e.startsWith(t)&&e.split("/").length>t.split("/").length?!0:[{from:/^\/blog\/[\w-]+/,to:/^\/blog\/?$/},{from:/^\/tools\/[\w-]+/,to:/^\/tools\/?$/},{from:/^\/search\/results/,to:/^\/search\/?$/}].some(n=>n.from.test(e)&&n.to.test(t))}classifyPageType(e){const t=e.replace(/\/$/,"")||"/";return t===""||t==="/"?"home":t==="/blog"?"blog-list":t.startsWith("/blog/")&&t!=="/blog"?"blog-post":t==="/tools"?"tools-list":t.startsWith("/tools/")&&t!=="/tools"?"tools-category":t.startsWith("/search")?"search":t==="/about"?"about":t==="/contact"?"contact":t==="/offline"?"offline":"unknown"}analyzePageRelationship(e,t,i,n){if(e===t)return"sibling";const r=[["blog-list","blog-post"],["tools-list","tools-category"],["home","blog-list"],["home","tools-list"]];return r.some(([d,u])=>e===d&&t===u)?"parent-child":r.some(([d,u])=>e===u&&t===d)?"child-parent":[["blog-list","search"],["tools-list","search"],["home","about"],["home","contact"]].some(([d,u])=>e===d&&t===u||e===u&&t===d)?"contextual":"unrelated"}getUserAgentInfo(){const e=navigator.userAgent.toLowerCase(),t=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e),i=window.matchMedia("(prefers-reduced-motion: reduce)").matches,n=navigator.hardwareConcurrency<=2||i,o=(navigator.connection||navigator.mozConnection||navigator.webkitConnection)?.effectiveType||"unknown";return{isMobile:t,isLowPowerMode:n,prefersReducedMotion:i,connectionType:o}}handleBeforePreparation(e){const i=e.detail?.to?.pathname||window.location.pathname;if(this.transitionInProgress)return;this.transitionInProgress=!0;const n=this.currentPath;try{this.isTransitionSupported()||console.warn("View Transition API not supported, using fallback");const r=this.detectNavigationContext(n,i);h.startMonitoring(this.getTransitionContextName(r)),this.applyMobileOptimizations(r),this.applyTransitionContext(r),this.applyUserPreferences(),this.applyPerformanceOptimizations(),this.updateMetrics(r)}catch(r){console.error("Error during transition preparation:",r),this.transitionInProgress=!1}}handleAfterSwap(e){try{const i=e.detail?.newDocument?.location?.pathname||window.location.pathname,n=h.stopMonitoring();this.updateNavigationHistory(i),this.currentPath=i,this.transitionInProgress=!1,n&&this.updatePerformanceMetrics(n)}catch(t){console.error("Error during transition after-swap:",t),this.transitionInProgress=!1}}handlePageLoad(e){this.transitionInProgress=!1}handlePopState(e){const t=window.location.pathname,i=this.detectNavigationContext(this.currentPath,t);i.direction="backward",this.applyTransitionContext(i),this.updateNavigationHistory(t),this.currentPath=t}applyMobileOptimizations(e){const t=p.getTransitionOptimization(),i=A.getPWATransitionSettings(),n=document.documentElement;t.shouldOptimize&&(n.style.setProperty("--transition-duration-optimized",`${t.recommendedDuration}ms`),n.style.setProperty("--transition-easing-optimized",t.recommendedEasing),n.setAttribute("data-transition-optimized",t.optimizationType)),i.shouldOptimize&&(n.style.setProperty("--transition-duration-pwa",`${i.duration}ms`),n.style.setProperty("--transition-easing-pwa",i.easing));const r=p.getDeviceCapabilities(),o=p.getNetworkCondition();n.setAttribute("data-device-mobile",r.isMobile.toString()),n.setAttribute("data-device-tablet",r.isTablet.toString()),n.setAttribute("data-device-pwa",r.isPWA.toString()),n.setAttribute("data-device-orientation",r.orientation),n.setAttribute("data-network-type",o.effectiveType),n.setAttribute("data-network-save-data",o.saveData.toString()),r.batteryLevel!==void 0&&n.setAttribute("data-battery-level",Math.round(r.batteryLevel*100).toString()),n.setAttribute("data-battery-low",r.isLowBattery.toString())}applyTransitionContext(e){const t=document.documentElement;t.setAttribute("data-transition-direction",e.direction),t.setAttribute("data-transition-from-type",e.fromPageType),t.setAttribute("data-transition-to-type",e.toPageType),t.setAttribute("data-transition-relationship",e.relationship),t.setAttribute("data-transition-context",this.getTransitionContextName(e));const i=this.getUserAgentInfo();i.prefersReducedMotion&&t.setAttribute("data-reduced-motion","true"),i.isLowPowerMode&&t.setAttribute("data-low-power","true")}getTransitionContextName(e){if(e.direction==="backward")return"backward";switch(e.relationship){case"parent-child":return"drill-down";case"child-parent":return"drill-up";case"sibling":return"sibling";case"contextual":return"contextual";default:return"forward"}}updateNavigationHistory(e){this.navigationHistory.push(e),this.navigationHistory.length>50&&(this.navigationHistory=this.navigationHistory.slice(-50))}updateMetrics(e){this.metrics.totalTransitions++,this.metrics.lastTransitionTime=e.timestamp;const t=this.estimateTransitionDuration(e);this.metrics.averageDuration=(this.metrics.averageDuration*(this.metrics.totalTransitions-1)+t)/this.metrics.totalTransitions}estimateTransitionDuration(e){const t=this.getUserAgentInfo();let i=300;switch(t.isLowPowerMode&&(i*=.7),e.relationship){case"sibling":i*=.8;break;case"parent-child":case"child-parent":i*=1.2;break}return i}getMetrics(){return{...this.metrics}}getCurrentContext(){if(this.navigationHistory.length<2)return null;const e=this.navigationHistory[this.navigationHistory.length-1],t=this.navigationHistory[this.navigationHistory.length-2];return this.detectNavigationContext(t,e)}isTransitionSupported(){return typeof document<"u"&&"startViewTransition"in document}applyUserPreferences(){const e=f.getPreferences(),t=f.getEffectiveIntensity(),i=document.documentElement;i.setAttribute("data-transition-intensity",t),e.customDuration&&i.style.setProperty("--transition-duration-custom",`${e.customDuration}ms`),e.debugMode&&i.setAttribute("data-debug-transitions","true"),i.setAttribute("data-sound-effects",e.enableSoundEffects.toString()),i.setAttribute("data-haptic-feedback",e.enableHapticFeedback.toString()),e.enableSoundEffects&&this.triggerSoundEffect(),e.enableHapticFeedback&&this.triggerHapticFeedback()}applyPerformanceOptimizations(){const e=h.getCurrentMetrics(),t=document.documentElement;t.setAttribute("data-performance-monitoring","true"),t.setAttribute("data-current-fps",e.frameRate.toString());const i=this.getUserAgentInfo();if(t.setAttribute("data-cpu-cores",navigator.hardwareConcurrency.toString()),i.isLowPowerMode?t.setAttribute("data-performance-mode","low"):e.frameRate>=55&&navigator.hardwareConcurrency>=8?t.setAttribute("data-performance-mode","high"):t.setAttribute("data-performance-mode","normal"),e.memoryUsage!==void 0){const n=e.memoryUsage>.8?"high":e.memoryUsage>.6?"medium":"low";t.setAttribute("data-memory-usage",n),e.memoryUsage>.8&&t.setAttribute("data-low-memory","true")}"getBattery"in navigator&&navigator.getBattery().then(n=>{t.setAttribute("data-battery-level",Math.round(n.level*100).toString()),t.setAttribute("data-battery-low",(n.level<.2).toString())}).catch(()=>{})}updatePerformanceMetrics(e){this.metrics.averageDuration=(this.metrics.averageDuration*(this.metrics.totalTransitions-1)+(e.endTime-e.startTime))/this.metrics.totalTransitions,e.averageFrameRate<30||e.droppedFrames>5?this.metrics.failureRate=(this.metrics.failureRate*(this.metrics.totalTransitions-1)+1)/this.metrics.totalTransitions:this.metrics.failureRate=this.metrics.failureRate*(this.metrics.totalTransitions-1)/this.metrics.totalTransitions}triggerSoundEffect(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),i=e.createGain();t.connect(i),i.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.exponentialRampToValueAtTime(400,e.currentTime+.1),i.gain.setValueAtTime(.1,e.currentTime),i.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),t.start(e.currentTime),t.stop(e.currentTime+.1)}catch(e){console.debug("Sound effect not available:",e)}}triggerHapticFeedback(){if("vibrate"in navigator)try{navigator.vibrate([10,5,10])}catch(e){console.debug("Haptic feedback not available:",e)}}getEnhancedMetrics(){const e=this.getMetrics(),t=h.getCurrentMetrics();return{...e,performanceData:t}}destroy(){typeof document<"u"&&(document.removeEventListener("astro:before-preparation",this.handleBeforePreparation.bind(this)),document.removeEventListener("astro:after-swap",this.handleAfterSwap.bind(this)),document.removeEventListener("astro:page-load",this.handlePageLoad.bind(this))),typeof window<"u"&&window.removeEventListener("popstate",this.handlePopState.bind(this)),h.destroy(),f.destroy(),this.isInitialized=!1}}const P=new g,L=Object.freeze(Object.defineProperty({__proto__:null,NavigationDirection:v,PageRelationship:b,PageType:y,TransitionController:g,default:g,transitionController:P},Symbol.toStringTag,{value:"Module"}));export{h as a,f as b,L as c,p as m,A as p,P as t};
