import{a as d,b as w}from"./transitionController.DXuiG6hA.js";var m=(o=>(o.HOME="home",o.BLOG_LIST="blog-list",o.BLOG_POST="blog-post",o.TOOLS_LIST="tools-list",o.TOOLS_CATEGORY="tools-category",o.SEARCH="search",o.ABOUT="about",o.CONTACT="contact",o.OFFLINE="offline",o.NOT_FOUND="not-found",o.UNKNOWN="unknown",o))(m||{});class y{routePatterns=[];transitionConfigs=new Map;defaultTransition;pageMetadataCache=new Map;constructor(){this.initializeDefaultPatterns(),this.initializeDefaultTransitions(),this.defaultTransition=this.createDefaultTransition()}initializeDefaultPatterns(){this.routePatterns=[{pattern:/^\/blog\/[\w-]+\/$/,pageType:"blog-post",priority:100},{pattern:/^\/blog\/?$/,pageType:"blog-list",priority:90},{pattern:/^\/tools\/[^\/]+\/?$/,pageType:"tools-category",priority:100},{pattern:/^\/tools\/?$/,pageType:"tools-list",priority:90},{pattern:/^\/search/,pageType:"search",priority:80},{pattern:/^\/about\/?$/,pageType:"about",priority:70},{pattern:/^\/contact\/?$/,pageType:"contact",priority:70},{pattern:/^\/offline\/?$/,pageType:"offline",priority:70},{pattern:/^\/404\/?$/,pageType:"not-found",priority:70},{pattern:/^\/?$/,pageType:"home",priority:10}],this.routePatterns.sort((t,e)=>e.priority-t.priority)}initializeDefaultTransitions(){this.transitionConfigs.set("slide-forward",{name:"slide-forward",duration:300,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)",cssClass:"transition-slide-forward",elements:[{selector:"main",transitionName:"main-content",animation:{keyframes:"slide-in-right",duration:300,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}}]}),this.transitionConfigs.set("slide-backward",{name:"slide-backward",duration:300,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)",cssClass:"transition-slide-backward",elements:[{selector:"main",transitionName:"main-content",animation:{keyframes:"slide-in-left",duration:300,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}}]}),this.transitionConfigs.set("fade",{name:"fade",duration:250,easing:"ease-in-out",cssClass:"transition-fade",elements:[{selector:"main",transitionName:"main-content",animation:{keyframes:"fade-in",duration:250,easing:"ease-in-out"}}]}),this.transitionConfigs.set("scale-up",{name:"scale-up",duration:350,easing:"cubic-bezier(0.0, 0.0, 0.2, 1)",cssClass:"transition-scale-up",elements:[{selector:"main",transitionName:"main-content",animation:{keyframes:"scale-in",duration:350,easing:"cubic-bezier(0.0, 0.0, 0.2, 1)"}}]}),this.transitionConfigs.set("scale-down",{name:"scale-down",duration:350,easing:"cubic-bezier(0.4, 0.0, 1, 1)",cssClass:"transition-scale-down",elements:[{selector:"main",transitionName:"main-content",animation:{keyframes:"scale-out",duration:350,easing:"cubic-bezier(0.4, 0.0, 1, 1)"}}]}),this.transitionConfigs.set("crossfade",{name:"crossfade",duration:400,easing:"ease-in-out",cssClass:"transition-crossfade",elements:[{selector:"main",transitionName:"main-content",animation:{keyframes:"crossfade",duration:400,easing:"ease-in-out"}}],conditions:[{type:"media-query",condition:"(prefers-reduced-motion: reduce)",fallback:this.transitionConfigs.get("fade")}]})}createDefaultTransition(){return{name:"default",duration:200,easing:"ease-in-out",cssClass:"transition-default",elements:[{selector:"main",transitionName:"main-content",animation:{keyframes:"fade-in",duration:200,easing:"ease-in-out"}}]}}registerTransition(t,e){this.routePatterns.push(t),this.routePatterns.sort((i,n)=>n.priority-i.priority),this.transitionConfigs.set(e.name,e)}registerPageType(t,e){const i={type:e,level:this.calculateRouteLevel(t),category:this.extractCategory(t),parentRoute:this.findParentRoute(t),childRoutes:this.findChildRoutes(t)};this.pageMetadataCache.set(t,i)}getPageType(t){const e=this.pageMetadataCache.get(t);if(e)return e.type;for(const i of this.routePatterns)if(this.matchesPattern(t,i.pattern))return i.pageType;return"unknown"}getTransitionForNavigation(t){const e=this.selectTransitionName(t),i=this.transitionConfigs.get(e);return i||(console.warn(`Transition '${e}' not found, using default`),this.defaultTransition)}setDefaultTransition(t){this.defaultTransition=t}getDefaultTransition(){return this.defaultTransition}getPageRelationship(t,e,i,n){if(t===e)return"sibling";if(t==="blog-list"&&e==="blog-post"||t==="blog-post"&&e==="blog-list"||t==="tools-list"&&e==="tools-category"||t==="tools-category"&&e==="tools-list")return"parent-child";const a=[["blog-list","tools-list"],["about","contact"],["search","blog-list"],["search","tools-list"]];for(const[r,s]of a)if(t===r&&e===s||t===s&&e===r)return"contextual";return"unrelated"}selectTransitionName(t){const{direction:e,relationship:i,fromPageType:n,toPageType:a}=t;return this.shouldUseReducedMotion()?"fade":i==="sibling"?e==="forward"?"slide-forward":"slide-backward":i==="parent-child"?n==="blog-list"&&a==="blog-post"||n==="tools-list"&&a==="tools-category"?"scale-up":"scale-down":i==="contextual"?"crossfade":"fade"}matchesPattern(t,e){return typeof e=="string"?t===e:e.test(t)}calculateRouteLevel(t){return t.split("/").filter(e=>e.length>0).length}extractCategory(t){const e=t.match(/^\/tools\/([^\/]+)/);if(e)return e[1]}findParentRoute(t){const e=t.split("/").filter(i=>i.length>0);if(!(e.length<=1))return e.pop(),"/"+e.join("/")}findChildRoutes(t){return[]}shouldUseReducedMotion(){return typeof window>"u"?!1:window.matchMedia("(prefers-reduced-motion: reduce)").matches}getAllPageTypes(){return Object.values(m)}getAllTransitions(){return new Map(this.transitionConfigs)}reset(){this.routePatterns=[],this.transitionConfigs.clear(),this.pageMetadataCache.clear(),this.initializeDefaultPatterns(),this.initializeDefaultTransitions(),this.defaultTransition=this.createDefaultTransition()}}const l=new y;class v{preloadedTransitions=new Map;preloadQueue=[];isPreloading=!1;observer;prefetchLinks=new Set;constructor(){this.initialize()}initialize(){typeof window>"u"||(this.setupLinkObserver(),document.addEventListener("astro:before-preparation",this.handleNavigationStart.bind(this)),document.addEventListener("astro:after-swap",this.handleNavigationComplete.bind(this)),this.preloadCriticalTransitions())}setupLinkObserver(){"IntersectionObserver"in window&&(this.observer=new IntersectionObserver(t=>{t.forEach(e=>{if(e.isIntersecting){const n=e.target.href;n&&this.shouldPrefetchLink(n)&&this.prefetchTransition(n,{priority:"low"})}})},{rootMargin:"100px",threshold:.1}),this.observeLinks())}observeLinks(){if(!this.observer)return;document.querySelectorAll('a[href^="/"], a[href^="./"], a[href^="../"]').forEach(e=>{this.observer.observe(e)})}shouldPrefetchLink(t){try{const e=new URL(t,window.location.origin);return!(e.origin!==window.location.origin||e.pathname===window.location.pathname||this.prefetchLinks.has(e.pathname)||[".pdf",".zip",".exe",".dmg"].some(n=>e.pathname.endsWith(n)))}catch{return!1}}async prefetchTransition(t,e={}){const i=window.location.pathname,n=`${i}->${t}`;if(!(this.preloadedTransitions.has(n)||this.preloadQueue.includes(n))){this.preloadQueue.push(n),this.prefetchLinks.add(t);try{const a=l.getPageType(i),r=l.getPageType(t),s=l.getPageRelationship(a,r,i,t),c={direction:"forward",fromPageType:a,toPageType:r,relationship:s},f=l.getTransitionForNavigation(c),g=await this.preloadResources(t,e);await this.prefetchWithAstro(t,e);const b={fromPath:i,toPath:t,transitionConfig:f,preloadedAt:Date.now(),resources:g};this.preloadedTransitions.set(n,b);const u=this.preloadQueue.indexOf(n);u>-1&&this.preloadQueue.splice(u,1)}catch(a){console.warn("Failed to prefetch transition:",a);const r=this.preloadQueue.indexOf(n);r>-1&&this.preloadQueue.splice(r,1)}}}async preloadResources(t,e){const i=[];if(e.priority==="high"&&i.push(await this.preloadResource(t,"page")),e.prefetchCSS!==!1){const n=await this.findCriticalCSS(t);for(const a of n)i.push(await this.preloadResource(a,"css"))}if(e.prefetchImages){const n=await this.findCriticalImages(t);for(const a of n)i.push(await this.preloadResource(a,"image"))}if(e.prefetchFonts){const n=await this.findCriticalFonts(t);for(const a of n)i.push(await this.preloadResource(a,"font"))}return i}async prefetchWithAstro(t,e){if(typeof window.astro?.prefetch=="function")try{await window.astro.prefetch(t,{priority:e.priority||"low"})}catch(i){console.warn("Astro prefetch failed:",i)}else this.manualPrefetch(t,e)}manualPrefetch(t,e){const i=document.createElement("link");i.rel="prefetch",i.href=t,e.priority==="high"&&i.setAttribute("importance","high"),document.head.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},3e4)}async preloadResource(t,e){const i={url:t,type:e,status:"loading"},n=Date.now();try{switch(e){case"page":await fetch(t,{method:"HEAD"});break;case"image":await this.preloadImage(t);break;case"font":await this.preloadFont(t);break;case"css":await this.preloadCSS(t);break;case"js":await this.preloadJS(t);break}i.status="loaded",i.loadTime=Date.now()-n}catch(a){i.status="error",console.warn(`Failed to preload ${e}:`,t,a)}return i}preloadImage(t){return new Promise((e,i)=>{const n=new Image;n.onload=()=>e(),n.onerror=i,n.src=t})}preloadFont(t){return new Promise((e,i)=>{const n=document.createElement("link");n.rel="preload",n.as="font",n.type="font/woff2",n.crossOrigin="anonymous",n.href=t,n.onload=()=>e(),n.onerror=i,document.head.appendChild(n)})}preloadCSS(t){return new Promise((e,i)=>{const n=document.createElement("link");n.rel="preload",n.as="style",n.href=t,n.onload=()=>e(),n.onerror=i,document.head.appendChild(n)})}preloadJS(t){return new Promise((e,i)=>{const n=document.createElement("link");n.rel="preload",n.as="script",n.href=t,n.onload=()=>e(),n.onerror=i,document.head.appendChild(n)})}async findCriticalCSS(t){return["/src/styles/global.css","/src/styles/advanced-transitions.css"]}async findCriticalImages(t){return[]}async findCriticalFonts(t){return["https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2","https://fonts.gstatic.com/s/jetbrainsmono/v13/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxjPVmUsaaDhw.woff2"]}preloadCriticalTransitions(){const t=window.location.pathname,e=l.getPageType(t),i=[];switch(e){case"home":i.push("/blog","/tools","/about");break;case"blog-list":const n=document.querySelectorAll('a[href^="/blog/"]');Array.from(n).slice(0,3).forEach(r=>{const s=r.href;s&&i.push(new URL(s).pathname)});break;case"blog-post":i.push("/blog");break;case"tools-list":const a=document.querySelectorAll('a[href^="/tools/"]');Array.from(a).slice(0,3).forEach(r=>{const s=r.href;s&&i.push(new URL(s).pathname)});break}i.forEach(n=>{this.prefetchTransition(n,{priority:"high",prefetchCSS:!0,prefetchImages:!1,prefetchFonts:!0})})}handleNavigationStart(t){const i=t.detail?.to?.pathname;if(!i)return;const a=`${window.location.pathname}->${i}`,r=this.preloadedTransitions.get(a);if(r){console.log("Using preloaded transition for:",i);const s=document.documentElement;s.setAttribute("data-transition-preloaded","true"),s.setAttribute("data-preload-time",(Date.now()-r.preloadedAt).toString())}}handleNavigationComplete(){const t=Date.now(),e=5*60*1e3;for(const[i,n]of this.preloadedTransitions.entries())t-n.preloadedAt>e&&this.preloadedTransitions.delete(i);setTimeout(()=>{this.observeLinks()},100)}getPreloadStats(){const t=Array.from(this.preloadedTransitions.values()),e=t.flatMap(r=>r.resources),i=e.filter(r=>r.status==="loaded"),n=i.length>0?i.reduce((r,s)=>r+(s.loadTime||0),0)/i.length:0,a=e.length>0?i.length/e.length:0;return{totalPreloaded:t.length,averageLoadTime:n,successRate:a,queueLength:this.preloadQueue.length}}prefetchPaths(t,e={}){return Promise.all(t.map(i=>this.prefetchTransition(i,e)))}clearPreloads(){this.preloadedTransitions.clear(),this.preloadQueue.length=0,this.prefetchLinks.clear()}destroy(){this.observer&&(this.observer.disconnect(),this.observer=void 0),document.removeEventListener("astro:before-preparation",this.handleNavigationStart.bind(this)),document.removeEventListener("astro:after-swap",this.handleNavigationComplete.bind(this)),this.clearPreloads()}}const C=new v;class T{settings;deviceCapabilities;isOptimizing=!1;optimizationInterval;constructor(){this.settings=this.getDefaultSettings(),this.deviceCapabilities=this.detectDeviceCapabilities(),this.initialize()}initialize(){typeof window>"u"||(this.startOptimization(),d.onPerformanceChange(t=>{this.handlePerformanceChange(t)}),this.setupBatteryMonitoring(),this.setupNetworkMonitoring(),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)))}getDefaultSettings(){return{enableHardwareAcceleration:!0,maxConcurrentTransitions:3,adaptiveDuration:!0,batteryAwareOptimization:!0,networkAwareOptimization:!0,frameRateTarget:60}}detectDeviceCapabilities(){const t=navigator.hardwareConcurrency||4,e=navigator.deviceMemory||4,i=this.estimateGPUTier(),n=this.detectRefreshRate(),a=this.detectSupportedFeatures();return{cpuCores:t,memoryGB:e,gpuTier:i,screenRefreshRate:n,supportedFeatures:a}}estimateGPUTier(){const t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)return"low";const i=e.getExtension("WEBGL_debug_renderer_info");if(!i)return"medium";const n=e.getParameter(i.UNMASKED_RENDERER_WEBGL).toLowerCase();return n.includes("nvidia")&&(n.includes("rtx")||n.includes("gtx"))||n.includes("amd")&&n.includes("radeon")||n.includes("apple")&&n.includes("m1")?"high":n.includes("intel")&&n.includes("hd")||n.includes("mali")||n.includes("adreno")?"low":"medium"}detectRefreshRate(){return 60}detectSupportedFeatures(){const t=[];return"startViewTransition"in document&&t.push("view-transitions"),"animate"in Element.prototype&&t.push("web-animations"),CSS.supports("contain","layout")&&t.push("css-containment"),CSS.supports("will-change","transform")&&t.push("will-change"),CSS.supports("transform","translate3d(0, 0, 0)")&&t.push("transform3d"),t}startOptimization(){this.isOptimizing||(this.isOptimizing=!0,this.optimizationInterval=window.setInterval(()=>{this.optimizeTransitions()},5e3),this.optimizeTransitions())}stopOptimization(){this.optimizationInterval&&(clearInterval(this.optimizationInterval),this.optimizationInterval=void 0),this.isOptimizing=!1}optimizeTransitions(){const t=this.getOptimizationRecommendations();this.applyOptimizations(t)}getOptimizationRecommendations(){const t=d.getCurrentMetrics(),e=w.getPreferences();let i=!1,n=300,a="cubic-bezier(0.4, 0.0, 0.2, 1)",r=!0,s=!0,c="high";return this.deviceCapabilities.cpuCores<=2||this.deviceCapabilities.memoryGB<=2?(i=!0,n=200,c="low"):(this.deviceCapabilities.cpuCores<=4||this.deviceCapabilities.memoryGB<=4)&&(c="medium"),this.deviceCapabilities.gpuTier==="low"&&(i=!0,r=!1,c="low"),t.frameRate<45&&(i=!0,n=Math.max(150,n*.7),a="ease-out"),t.memoryUsage&&t.memoryUsage>.8&&(i=!0,s=!1,c="low"),this.isBatteryLow()&&(i=!0,n=Math.max(100,n*.5),s=!1,c="low"),this.isSlowNetwork()&&(s=!1,n=Math.max(150,n*.8)),e.reducedMotion&&(i=!0,n=0,c="low"),{shouldSimplifyAnimations:i,recommendedDuration:n,recommendedEasing:a,shouldUseHardwareAcceleration:r,shouldEnablePreloading:s,maxAnimationComplexity:c}}applyOptimizations(t){const e=document.documentElement;this.settings.adaptiveDuration&&(e.style.setProperty("--transition-duration-optimized",`${t.recommendedDuration}ms`),e.style.setProperty("--transition-easing-optimized",t.recommendedEasing)),e.setAttribute("data-animation-complexity",t.maxAnimationComplexity),e.setAttribute("data-hardware-acceleration",t.shouldUseHardwareAcceleration.toString()),e.setAttribute("data-simplified-animations",t.shouldSimplifyAnimations.toString()),e.setAttribute("data-preloading-enabled",t.shouldEnablePreloading.toString()),e.setAttribute("data-cpu-cores",this.deviceCapabilities.cpuCores.toString()),e.setAttribute("data-memory-gb",this.deviceCapabilities.memoryGB.toString()),e.setAttribute("data-gpu-tier",this.deviceCapabilities.gpuTier),e.setAttribute("data-refresh-rate",this.deviceCapabilities.screenRefreshRate.toString());const i=d.getCurrentMetrics();e.setAttribute("data-current-fps",Math.round(i.frameRate).toString()),i.memoryUsage!==void 0&&e.setAttribute("data-memory-usage",Math.round(i.memoryUsage*100).toString())}handlePerformanceChange(t){t.frameRate<30&&this.applyEmergencyOptimizations()}applyEmergencyOptimizations(){const t=document.documentElement;t.setAttribute("data-emergency-mode","true"),t.style.setProperty("--transition-duration-optimized","100ms"),t.style.setProperty("--transition-easing-optimized","ease-out"),t.setAttribute("data-force-simple-transitions","true"),console.warn("Emergency transition optimizations applied due to poor performance")}setupBatteryMonitoring(){"getBattery"in navigator&&navigator.getBattery().then(t=>{const e=()=>{const i=document.documentElement;i.setAttribute("data-battery-level",Math.round(t.level*100).toString()),i.setAttribute("data-battery-charging",t.charging.toString()),i.setAttribute("data-battery-low",(t.level<.2).toString())};e(),t.addEventListener("levelchange",e),t.addEventListener("chargingchange",e)}).catch(()=>{})}setupNetworkMonitoring(){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){const e=()=>{const i=document.documentElement;i.setAttribute("data-connection-type",t.effectiveType||"unknown"),i.setAttribute("data-connection-downlink",t.downlink?.toString()||"unknown"),i.setAttribute("data-save-data",t.saveData?.toString()||"false")};e(),t.addEventListener("change",e)}}handleVisibilityChange(){document.hidden?this.stopOptimization():this.startOptimization()}isBatteryLow(){const t=document.documentElement.getAttribute("data-battery-level");return t?parseInt(t)<20:!1}isSlowNetwork(){const t=document.documentElement.getAttribute("data-connection-type");return t==="slow-2g"||t==="2g"}getSettings(){return{...this.settings}}updateSettings(t){this.settings={...this.settings,...t},this.optimizeTransitions()}getDeviceCapabilities(){return{...this.deviceCapabilities}}forceOptimization(){this.optimizeTransitions()}resetOptimizations(){const t=document.documentElement;t.removeAttribute("data-animation-complexity"),t.removeAttribute("data-hardware-acceleration"),t.removeAttribute("data-simplified-animations"),t.removeAttribute("data-preloading-enabled"),t.removeAttribute("data-emergency-mode"),t.removeAttribute("data-force-simple-transitions"),t.style.removeProperty("--transition-duration-optimized"),t.style.removeProperty("--transition-easing-optimized")}destroy(){this.stopOptimization(),document.removeEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),this.resetOptimizations()}}const h=new T;function p(){const o=window.location.pathname,t=l.getPageType(o);console.log("Enhanced transition system with preloading and optimization initialized for page type:",t),setTimeout(()=>{const e=C.getPreloadStats(),i=h.getDeviceCapabilities(),n=h.getOptimizationRecommendations();console.log("Transition system stats:",{preloadStats:e,deviceCapabilities:i,optimizationRecommendations:n})},2e3)}function z(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p()}z();
