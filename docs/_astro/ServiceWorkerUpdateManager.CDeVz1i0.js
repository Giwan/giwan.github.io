import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.BVOCwoKb.js";import{c as w}from"./createLucideIcon.tO8mbuOy.js";import{X as x,R as k,h as b}from"./pwa.CDmEfaOl.js";import"./transitionController.CW2NVXhh.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],N=w("download",E),S=({onUpdate:u,onDismiss:n,isVisible:c})=>{const[l,i]=s.useState(!1),[d,h]=s.useState(!1);s.useEffect(()=>{if(c){const f=setTimeout(()=>i(!0),100);return()=>clearTimeout(f)}else i(!1)},[c]);const g=()=>{h(!0),i(!1),setTimeout(()=>{u()},200)},m=()=>{i(!1),setTimeout(()=>{n()},200)};return c?t.jsx("div",{className:`fixed bottom-4 right-4 z-50 max-w-sm transition-all duration-300 ease-in-out ${l?"translate-y-0 opacity-100":"translate-y-full opacity-0"}`,role:"alert","aria-live":"polite","aria-labelledby":"update-notification-title",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(N,{className:"h-5 w-5 text-blue-500 mr-2 flex-shrink-0"}),t.jsx("h3",{id:"update-notification-title",className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Update Available"})]}),t.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Dismiss update notification",children:t.jsx(x,{className:"h-4 w-4"})})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"A new version of the blog is available. Update now to get the latest content and features."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:g,disabled:d,className:"flex items-center px-3 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",children:[t.jsx(k,{className:`h-4 w-4 mr-1 ${d?"animate-spin":""}`}),d?"Updating...":"Update"]}),t.jsx("button",{onClick:m,className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",children:"Later"})]})]})}):null},W=()=>{const[u,n]=s.useState(!1),[c,l]=s.useState(!1),[i,d]=s.useState(null),[h,g]=s.useState(!1),[m,f]=s.useState(null),o=(e,r)=>{const a={type:"service-worker",message:`Service worker error in ${r}: ${e.message}`,originalError:e,timestamp:Date.now()};b(a),g(!0),f(e.message)},v=()=>{g(!1),f(null)},y=async()=>{try{if(typeof window>"u"||!("serviceWorker"in navigator))return;v();const e=await navigator.serviceWorker.ready;e.waiting&&(d(e.waiting),n(!0),l(!0)),e.addEventListener("updatefound",()=>{const r=e.installing;r&&(r.addEventListener("statechange",()=>{try{r.state==="installed"&&navigator.serviceWorker.controller&&(d(r),n(!0),l(!0))}catch(a){o(a,"state change handling")}}),r.addEventListener("error",a=>{o(new Error("Service worker installation failed"),"installation")}))}),navigator.serviceWorker.addEventListener("controllerchange",()=>{try{window.location.reload()}catch(r){o(r,"controller change")}}),e.addEventListener("error",r=>{o(new Error("Service worker runtime error"),"runtime")})}catch(e){o(e,"setup")}};return s.useEffect(()=>{y();const e=a=>{try{a.data&&a.data.type==="SKIP_WAITING"&&(n(!0),l(!0))}catch(p){o(p,"message handling")}},r=a=>{const p=a.detail;p.type==="service-worker"&&(g(!0),f(p.message))};return navigator.serviceWorker?.addEventListener("message",e),window.addEventListener("pwa-error",r),()=>{navigator.serviceWorker?.removeEventListener("message",e),window.removeEventListener("pwa-error",r)}},[]),{updateAvailable:u,showNotification:c,updateServiceWorker:()=>{try{i&&(i.postMessage({type:"SKIP_WAITING"}),l(!1),v())}catch(e){o(e,"update activation")}},dismissNotification:()=>{try{l(!1),i&&localStorage.setItem("sw-update-dismissed",Date.now().toString())}catch(e){o(e,"notification dismissal")}},hasError:h,errorMessage:m,retryRegistration:()=>{v(),y()}}},R=()=>{const{showNotification:u,updateServiceWorker:n,dismissNotification:c}=W();return t.jsx(S,{isVisible:u,onUpdate:n,onDismiss:c})};export{R as default};
