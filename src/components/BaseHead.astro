---
// Import the global.css file here so that it is included on
// all pages through the use of the <BaseHead /> component.
import "../styles/global.css";
import "../styles/enhanced-transitions.css";
import {
    SITE_CONFIG,
    PWA_CONFIG,
    APPLE_TOUCH_ICONS,
    APPLE_SPLASH_SCREENS,
    WINDOWS_TILE_ICONS,
} from "../config";
import SEO from "./SEO.astro";

// Font imports
import "@fontsource/inter/400.css";
import "@fontsource/inter/500.css";
import "@fontsource/inter/600.css";
import "@fontsource/inter/700.css";

import "@fontsource/merriweather/400.css";
import "@fontsource/merriweather/400-italic.css";
import "@fontsource/merriweather/700.css";

import "@fontsource/jetbrains-mono/400.css";
import "@fontsource/jetbrains-mono/600.css";

import "@fontsource/fira-code/400.css";
import "@fontsource/fira-code/500.css";
import "@fontsource/fira-code/600.css";


export interface Props {
    title: string;
    description: string;
    image?: string;
}

const { title, description, image } = Astro.props;

---

<!-- Global Metadata -->
<meta charset="utf-8" />

<!-- Optimized viewport for PWA -->
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />

<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json" />

<!-- Apple PWA Meta Tags -->
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content={SITE_CONFIG.title} />

<!-- Apple Touch Icons -->
{
    APPLE_TOUCH_ICONS.map(({ href, sizes }) => (
        sizes ? (
            <link rel="apple-touch-icon" href={href} sizes={sizes} />
        ) : (
            <link rel="apple-touch-icon" href={href} />
        )
    ))
}

<!-- iOS Splash Screens - Using available splash screen images -->
{
    APPLE_SPLASH_SCREENS.map(({ href, media }) => (
        media ? (
            <link rel="apple-touch-startup-image" href={href} media={media} />
        ) : (
            <link rel="apple-touch-startup-image" href={href} />
        )
    ))
}

<!-- Windows Tile Configuration -->
<meta name="msapplication-TileColor" content={WINDOWS_TILE_ICONS.tileColor} />
<meta name="msapplication-TileImage" content={WINDOWS_TILE_ICONS.tileImage} />
<meta name="msapplication-square70x70logo" content={WINDOWS_TILE_ICONS.square70} />
<meta name="msapplication-square150x150logo" content={WINDOWS_TILE_ICONS.square150} />
<meta name="msapplication-wide310x150logo" content={WINDOWS_TILE_ICONS.wide310} />
<meta name="msapplication-square310x310logo" content={WINDOWS_TILE_ICONS.square310} />

<meta name="generator" content={Astro.generator} />
<meta name="theme-color" content={PWA_CONFIG.themeColor} />

<!-- SEO Component -->
<SEO title={title} description={description} image={image} />

{SITE_CONFIG.umamiWebsiteId && (
    <script 
        defer 
        src="https://cloud.umami.is/script.js" 
        data-website-id={SITE_CONFIG.umamiWebsiteId}
    ></script>
)}

<script is:inline>
  // Theme initialization
  (function() {
    const STORAGE_KEY = 'theme';
    const DARK_CLASS = 'dark';
    const THEME_VALUES = {
      DARK: 'dark',
      LIGHT: 'light',
      SYSTEM: 'system',
    };

    function getSystemTheme() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches 
        ? THEME_VALUES.DARK 
        : THEME_VALUES.LIGHT;
    }

    function getInitialTheme() {
      const persistedTheme = localStorage.getItem(STORAGE_KEY);
      if (persistedTheme === THEME_VALUES.SYSTEM || !persistedTheme) {
        return getSystemTheme();
      }
      return persistedTheme;
    }

    const theme = getInitialTheme();
    const root = document.documentElement;

    if (theme === THEME_VALUES.DARK) {
      root.classList.add(DARK_CLASS);
      root.setAttribute('data-theme', THEME_VALUES.DARK);
    } else {
      root.classList.remove(DARK_CLASS);
      root.setAttribute('data-theme', THEME_VALUES.LIGHT);
    }
  })();
</script>
