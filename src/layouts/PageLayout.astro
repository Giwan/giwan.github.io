---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import ServiceWorkerUpdateManager from "../components/ServiceWorkerUpdateManager";
import PWAErrorBoundary from "../components/PWAErrorBoundary";
import ConditionalContent from "../components/ConditionalContent";
import { AccessibilityControls } from "../components/AccessibilityControls";
import { SITE_CONFIG } from "../config";
import "../styles/global.css";


export interface Props {
    content: {
        title: string;
        description: string;
        image?: string;
        article?: boolean;
        publishedTime?: string;
        modifiedTime?: string;
        author?: string;
        section?: string;
        tags?: string[];
        keywords?: string[];
    };
}

const {
    content: { 
        title, 
        description, 
        image,
        article,
        publishedTime,
        modifiedTime,
        author,
        section,
        tags,
        keywords
    },
} = Astro.props;
---

<html lang={SITE_CONFIG.lang} dir={SITE_CONFIG.dir} transition:animate="fade">
    <head>
        <BaseHead 
            title={title} 
            description={description} 
            image={image}
            article={article}
            publishedTime={publishedTime}
            modifiedTime={modifiedTime}
            author={author}
            section={section}
            tags={tags}
            keywords={keywords}
        />


    </head>

    <body
        class="bg-background min-h-screen font-sans text-foreground leading-relaxed"
    >
        <!-- Skip Navigation Links -->
        <nav class="skip-links" aria-label="Skip navigation">
            <a href="#main-content" class="skip-link" style="view-transition-name: skip-link-main;">
                Skip to main content
            </a>
            <a href="#navigation" class="skip-link" style="view-transition-name: skip-link-nav;">
                Skip to navigation
            </a>
            <a href="#footer" class="skip-link" style="view-transition-name: skip-link-footer;">
                Skip to footer
            </a>
        </nav>

        <PWAErrorBoundary client:idle>
            <div 
                class="mx-auto max-w-7xl p-4 sm:p-6 lg:p-8" 
                style="padding-top: calc(var(--sat) + 1rem);" 
                transition:name="page-container"
            >
                <Header transition:name="header" />
                <ConditionalContent client:load>
                    <main id="main-content" role="main" transition:name="main-content" transition:animate="slide">
                        <slot />
                    </main>
                    <Footer transition:name="footer" />
                </ConditionalContent>
            </div>
        </PWAErrorBoundary>

        <ServiceWorkerUpdateManager client:idle />
        <AccessibilityControls client:idle />
        <noscript>
            <div class="noscript-message" role="status">
                JavaScript is disabled. Interactive controls (theme, accessibility preferences, advanced transitions) require it,
                but core content and skip links remain available.
            </div>
        </noscript>
        
        <script src="../scripts/accessibilityInitializer.ts"></script>
        <script src="../scripts/navigationHandler.ts"></script>
        <script src="../utils/transition-init.ts"></script>
    </body>
</html>
