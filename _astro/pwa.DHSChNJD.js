import{c as g}from"./createLucideIcon.tO8mbuOy.js";import{m as a,t as c,p as d}from"./transitionController.BO8QMcyu.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],y=g("refresh-cw",u);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],f=g("x",h);class m{config;isInitialized=!1;cleanupFunctions=[];constructor(t={}){this.config={enableMobileOptimizations:!0,enablePWAIntegration:!0,enableNetworkAwareness:!0,enableBatteryOptimizations:!0,enableOrientationHandling:!0,debugMode:!1,...t}}async initialize(){if(!(typeof window>"u"||this.isInitialized))try{this.log("Initializing mobile transition optimizations..."),this.config.enableMobileOptimizations&&await this.initializeMobileOptimizer(),this.config.enablePWAIntegration&&await this.initializePWAIntegration(),this.setupSystemCoordination(),this.config.debugMode&&this.setupDebugLogging(),this.isInitialized=!0,this.log("Mobile transition optimizations initialized successfully")}catch(t){console.error("Failed to initialize mobile transition optimizations:",t)}}async initializeMobileOptimizer(){if(this.log("Setting up mobile optimizer..."),this.config.enableOrientationHandling){const t=a.onOrientationChange(()=>{this.log("Orientation changed, updating transition optimizations"),this.updateTransitionOptimizations()});this.cleanupFunctions.push(t)}if(this.config.enableNetworkAwareness){const t=a.onNetworkChange(i=>{this.log(`Network condition changed: ${i.effectiveType}`),this.updateTransitionOptimizations()});this.cleanupFunctions.push(t)}if(this.config.enableBatteryOptimizations){const t=a.onBatteryChange(i=>{this.log(`Battery state changed: ${i?"low":"normal"}`),this.updateTransitionOptimizations()});this.cleanupFunctions.push(t)}}async initializePWAIntegration(){this.log("Setting up PWA integration..."),window.addEventListener("pwa-update-available",t=>{this.log("PWA update available"),this.handlePWAUpdate(t)}),window.addEventListener("pwa-network-change",t=>{this.log(`PWA network state changed: ${t.detail.isOnline?"online":"offline"}`),this.updateTransitionOptimizations()}),window.addEventListener("pwa-installed",t=>{this.log("PWA installed"),this.handlePWAInstalled(t)})}setupSystemCoordination(){this.log("Setting up system coordination...");const t=c.applyTransitionContext;t&&(c.applyTransitionContext=i=>{this.applyCoordinatedOptimizations(i),t.call(c,i)}),setInterval(()=>{this.updateTransitionOptimizations()},3e4)}applyCoordinatedOptimizations(t){const i=a.getTransitionOptimization(),n=d.getPWATransitionSettings(),e=a.getDeviceCapabilities(),r=document.documentElement;let s=300,l="cubic-bezier(0.4, 0.0, 0.2, 1)";i.shouldOptimize&&(s=Math.min(s,i.recommendedDuration),l=i.recommendedEasing),n.shouldOptimize&&(s=Math.min(s,n.duration),l=n.easing),e.isLowBattery&&(s=Math.min(s,150)),a.canHandleComplexTransitions()||(s=Math.min(s,200),l="ease-out"),r.style.setProperty("--transition-duration-coordinated",`${s}ms`),r.style.setProperty("--transition-easing-coordinated",l),this.log(`Applied coordinated optimizations: ${s}ms, ${l}`)}updateTransitionOptimizations(){const t=a.getDeviceCapabilities(),i=a.getNetworkCondition(),n=d.getPWAState(),e=document.documentElement;e.setAttribute("data-device-mobile",t.isMobile.toString()),e.setAttribute("data-device-tablet",t.isTablet.toString()),e.setAttribute("data-device-pwa",t.isPWA.toString()),e.setAttribute("data-device-orientation",t.orientation),e.setAttribute("data-network-type",i.effectiveType),e.setAttribute("data-network-save-data",i.saveData.toString()),t.batteryLevel!==void 0&&e.setAttribute("data-battery-level",Math.round(t.batteryLevel*100).toString()),e.setAttribute("data-battery-low",t.isLowBattery.toString()),e.setAttribute("data-pwa-online",n.isOnline.toString()),e.setAttribute("data-pwa-installed",n.isInstalled.toString()),e.setAttribute("data-pwa-sw-ready",n.serviceWorkerReady.toString()),this.log("Updated transition optimizations")}handlePWAUpdate(t){const i=document.documentElement;i.setAttribute("data-pwa-update-available","true"),i.style.setProperty("--transition-duration-update","150ms"),setTimeout(()=>{i.removeAttribute("data-pwa-update-available"),i.style.removeProperty("--transition-duration-update")},5e3)}handlePWAInstalled(t){const i=document.documentElement;i.setAttribute("data-pwa-newly-installed","true");const n=d.getPWATransitionSettings();i.style.setProperty("--transition-duration-pwa-installed",`${n.duration}ms`),i.style.setProperty("--transition-easing-pwa-installed",n.easing),setTimeout(()=>{i.removeAttribute("data-pwa-newly-installed")},1e4)}setupDebugLogging(){this.log("Debug mode enabled"),document.addEventListener("astro:before-preparation",i=>{const n=i;this.log("Transition starting:",{from:window.location.pathname,to:n.detail?.to?.pathname,deviceCapabilities:a.getDeviceCapabilities(),networkCondition:a.getNetworkCondition(),pwaState:d.getPWAState()})}),document.addEventListener("astro:after-swap",()=>{this.log("Transition completed")});const t=this.updateTransitionOptimizations.bind(this);this.updateTransitionOptimizations=()=>{this.log("Updating optimizations..."),t()}}log(t,i){this.config.debugMode&&(i?console.log(`[MobileTransitions] ${t}`,i):console.log(`[MobileTransitions] ${t}`))}getOptimizationStatus(){return{isInitialized:this.isInitialized,mobileOptimization:a.getTransitionOptimization(),pwaSettings:d.getPWATransitionSettings(),deviceCapabilities:a.getDeviceCapabilities(),networkCondition:a.getNetworkCondition()}}destroy(){this.cleanupFunctions.forEach(t=>t()),this.cleanupFunctions=[],this.isInitialized=!1,this.log("Mobile transition optimizations destroyed")}}const p=new m;typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{p.initialize()}):p.initialize());const z=async()=>{try{const o=await caches.keys();for(const t of o)try{const i=await caches.open(t),n=await i.keys();for(let e=0;e<Math.min(n.length,3);e++){const r=await i.match(n[e]);r&&await r.text()}}catch{console.warn(`Cache ${t} appears corrupted, clearing...`),await caches.delete(t)}}catch(o){console.warn("Failed to clear corrupted caches:",o)}},v=o=>{console.error(`PWA Error [${o.type}]:`,o.message,o.originalError);try{const t=JSON.parse(localStorage.getItem("pwa-errors")||"[]");t.push(o),t.length>10&&t.splice(0,t.length-10),localStorage.setItem("pwa-errors",JSON.stringify(t))}catch(t){console.warn("Failed to store PWA error:",t)}window.dispatchEvent(new CustomEvent("pwa-error",{detail:o}))},A=()=>{try{localStorage.removeItem("pwa-errors")}catch(o){console.warn("Failed to clear PWA errors:",o)}};export{y as R,f as X,A as a,z as c,v as h};
