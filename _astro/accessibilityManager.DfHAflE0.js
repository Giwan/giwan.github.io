class u{preferences;announcer=null;focusHistory=[];lastFocusedElement=null;isTransitioning=!1;constructor(){this.preferences=this.loadPreferences(),this.init()}init(){typeof document>"u"||(this.createScreenReaderAnnouncer(),this.setupTransitionEventListeners(),this.setupKeyboardNavigation(),this.setupReducedMotionHandling(),this.setupFocusManagement())}loadPreferences(){const e=typeof localStorage<"u"?localStorage.getItem("accessibility-preferences"):null,t={reducedMotion:this.detectReducedMotionPreference(),screenReaderAnnouncements:!0,focusManagement:!0,keyboardNavigation:!0};if(e)try{return{...t,...JSON.parse(e)}}catch{return t}return t}detectReducedMotionPreference(){return typeof window>"u"?!1:window.matchMedia("(prefers-reduced-motion: reduce)").matches}createScreenReaderAnnouncer(){this.preferences.screenReaderAnnouncements&&(this.announcer=document.createElement("div"),this.announcer.setAttribute("aria-live","polite"),this.announcer.setAttribute("aria-atomic","true"),this.announcer.className="sr-only",this.announcer.id="accessibility-announcer",this.announcer.style.cssText=`
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    `,document.body.appendChild(this.announcer))}setupTransitionEventListeners(){document.addEventListener("astro:before-preparation",this.handleTransitionStart.bind(this)),document.addEventListener("astro:after-swap",this.handleTransitionComplete.bind(this)),document.addEventListener("astro:page-load",this.handlePageLoad.bind(this))}handleTransitionStart(e){if(this.isTransitioning=!0,this.lastFocusedElement=document.activeElement,this.preferences.screenReaderAnnouncements){const t=e,n=t.detail?.from?.pathname||"current page",i=t.detail?.to?.pathname||"new page";this.announce({message:`Navigating from ${this.getPageTitle(n)} to ${this.getPageTitle(i)}`,priority:"polite"})}this.applyReducedMotionPreferences()}handleTransitionComplete(){if(this.isTransitioning=!1,this.preferences.focusManagement&&this.manageFocusAfterTransition(),this.preferences.screenReaderAnnouncements){const e=document.title||"New page";this.announce({message:`${e} loaded`,priority:"polite",delay:100})}}handlePageLoad(){this.updateLandmarkTransitionNames(),this.setupSkipLinks()}setupKeyboardNavigation(){this.preferences.keyboardNavigation&&(document.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="/"&&(e.preventDefault(),this.skipToMainContent()),e.altKey&&e.key==="ArrowLeft"&&(e.preventDefault(),this.navigateBack()),e.altKey&&e.key==="ArrowRight"&&(e.preventDefault(),this.navigateForward()),(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),this.focusSearch()),e.key==="Escape"&&this.handleEscapeKey(),e.key==="Tab"&&this.isTransitioning&&this.handleTabDuringTransition(e)}),document.addEventListener("focusin",e=>{this.isTransitioning&&this.handleFocusDuringTransition(e)}))}setupReducedMotionHandling(){window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",t=>{this.preferences.reducedMotion=t.matches,this.applyReducedMotionPreferences(),this.savePreferences()})}applyReducedMotionPreferences(){const e=document.documentElement;this.preferences.reducedMotion?(e.setAttribute("data-reduced-motion","true"),e.style.setProperty("--transition-duration-fast","0ms"),e.style.setProperty("--transition-duration-normal","0ms"),e.style.setProperty("--transition-duration-slow","0ms")):(e.removeAttribute("data-reduced-motion"),e.style.removeProperty("--transition-duration-fast"),e.style.removeProperty("--transition-duration-normal"),e.style.removeProperty("--transition-duration-slow"))}setupFocusManagement(){this.preferences.focusManagement&&document.addEventListener("focusin",e=>{this.isTransitioning||(this.focusHistory.push(e.target),this.focusHistory.length>10&&this.focusHistory.shift())})}manageFocusAfterTransition(){const e=document.getElementById("main-content");if(e){e.setAttribute("tabindex","-1"),e.focus(),setTimeout(()=>{e.removeAttribute("tabindex")},100);return}const t=this.getFirstFocusableElement();t&&t.focus()}getFirstFocusableElement(){const e=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'];for(const t of e){const n=document.querySelector(t);if(n&&this.isElementVisible(n))return n}return null}isElementVisible(e){const t=e.getBoundingClientRect();return t.width>0&&t.height>0&&window.getComputedStyle(e).visibility!=="hidden"}updateLandmarkTransitionNames(){const e=document.querySelector("main");e&&!e.style.viewTransitionName&&(e.style.viewTransitionName="main-content");const t=document.querySelector('nav[aria-label="Main navigation"]');t&&!t.style.viewTransitionName&&(t.style.viewTransitionName="navigation");const n=document.querySelector('header[role="banner"]');n&&!n.style.viewTransitionName&&(n.style.viewTransitionName="header");const i=document.querySelector('footer[role="contentinfo"]');i&&!i.style.viewTransitionName&&(i.style.viewTransitionName="footer"),document.querySelectorAll(".skip-link").forEach((o,c)=>{o.style.viewTransitionName||(o.style.viewTransitionName=`skip-link-${c}`)})}setupSkipLinks(){document.querySelectorAll(".skip-link").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const i=t.getAttribute("href");if(i&&i.startsWith("#")){const r=document.querySelector(i);if(r){const o=r.getAttribute("tabindex");if(o||r.setAttribute("tabindex","-1"),r.focus(),r.scrollIntoView({behavior:this.preferences.reducedMotion?"auto":"smooth",block:"start"}),this.preferences.screenReaderAnnouncements){const c=this.getSkipTargetName(i);this.announce({message:`Skipped to ${c}`,priority:"polite",delay:100})}o||setTimeout(()=>{r.removeAttribute("tabindex")},100)}}})})}getSkipTargetName(e){return{"#main-content":"main content","#navigation":"navigation","#footer":"footer","#search":"search","#sidebar":"sidebar"}[e]||e.substring(1)}announce(e){if(!this.announcer||!this.preferences.screenReaderAnnouncements)return;const t=()=>{this.announcer&&(this.announcer.setAttribute("aria-live",e.priority),this.announcer.textContent=e.message,setTimeout(()=>{this.announcer&&(this.announcer.textContent="")},1e3))};e.delay?setTimeout(t,e.delay):t()}skipToMainContent(){const e=document.getElementById("main-content");e&&(e.setAttribute("tabindex","-1"),e.focus(),e.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{e.removeAttribute("tabindex")},100))}navigateBack(){window.history.length>1&&window.history.back()}navigateForward(){window.history.forward()}focusSearch(){const e=document.querySelector('input[type="search"], input[name="search"], #search-input');e&&(e.focus(),this.preferences.screenReaderAnnouncements&&this.announce({message:"Search focused",priority:"polite"}))}handleEscapeKey(){const e=document.querySelectorAll('[role="dialog"][aria-hidden="false"], .modal.open, .panel.open');e.length>0&&e.forEach(t=>{const n=t.querySelector('[aria-label*="close"], [aria-label*="Close"], .close-button');n&&n.click()})}handleTabDuringTransition(e){const t=document.getElementById("main-content");if(!t)return;const n=t.querySelectorAll('a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])');if(n.length===0)return;const i=n[0],r=n[n.length-1];e.shiftKey?document.activeElement===i&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),i.focus())}handleFocusDuringTransition(e){const t=e.target;if(t&&this.preferences.screenReaderAnnouncements){const n=t.tagName.toLowerCase(),i=t.getAttribute("role"),r=t.getAttribute("aria-label")||t.textContent?.trim();r&&(n==="button"||n==="a"||i)&&t.matches('[aria-describedby], [aria-expanded], [role="button"], [role="link"]')&&this.announce({message:`Focused on ${r}`,priority:"polite",delay:200})}}getPageTitle(e){const t={"/":"Home","/blog":"Blog","/tools":"Tools","/about":"About","/contact":"Contact","/search":"Search","/offline":"Offline"};return t[e]?t[e]:e.startsWith("/blog/")?"Blog Article":e.startsWith("/tools/")?"Tools Category":"Page"}updatePreferences(e){this.preferences={...this.preferences,...e},this.savePreferences(),this.applyReducedMotionPreferences()}savePreferences(){typeof localStorage<"u"&&localStorage.setItem("accessibility-preferences",JSON.stringify(this.preferences))}getPreferences(){return{...this.preferences}}destroy(){this.announcer&&(document.body.removeChild(this.announcer),this.announcer=null)}}let s=null;const d={getInstance(){return s||(s=new u),s},getPreferences(){return this.getInstance().getPreferences()},updatePreferences(a){return this.getInstance().updatePreferences(a)},announce(a){return this.getInstance().announce(a)},destroy(){s&&(s.destroy(),s=null)}};export{d as a};
