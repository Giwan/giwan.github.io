import{j as r}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.BVOCwoKb.js";import{c as o,a as n,R as l,X as c}from"./pwa.C-OhJf2M.js";import{c as d}from"./createLucideIcon.tO8mbuOy.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],h=d("triangle-alert",m);class v extends i.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null,showDetails:!1,isRecovering:!1,recoveryAttempts:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t),console.error("PWA Error Boundary caught an error:",e,t);try{const a={error:{name:e.name,message:e.message,stack:e.stack},errorInfo:t,timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href},s=JSON.parse(localStorage.getItem("pwa-component-errors")||"[]");s.push(a),s.length>5&&s.splice(0,s.length-5),localStorage.setItem("pwa-component-errors",JSON.stringify(s))}catch(a){console.warn("Failed to store component error:",a)}}handleRetry=async()=>{this.setState({isRecovering:!0,recoveryAttempts:this.state.recoveryAttempts+1});try{(this.state.error?.message.includes("cache")||this.state.error?.message.includes("storage"))&&await o(),await new Promise(e=>setTimeout(e,1e3)),this.setState({hasError:!1,error:null,errorInfo:null,showDetails:!1,isRecovering:!1})}catch(e){console.warn("Recovery attempt failed:",e),this.setState({isRecovering:!1})}};handleAdvancedRecovery=async()=>{this.setState({isRecovering:!0});try{if(await o(),n(),localStorage.removeItem("pwa-component-errors"),"serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const t of e)await t.unregister()}await new Promise(e=>setTimeout(e,1500)),window.location.reload()}catch(e){console.warn("Advanced recovery failed:",e),this.setState({isRecovering:!1})}};toggleDetails=()=>{this.setState(e=>({showDetails:!e.showDetails}))};render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-md z-50",children:r.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 shadow-lg",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(h,{className:"h-5 w-5 text-red-500 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-1",children:"PWA Feature Unavailable"}),r.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mb-3",children:"Some advanced features may not be working properly. The site will continue to function normally."}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("button",{onClick:this.handleRetry,className:"inline-flex items-center px-3 py-1.5 bg-red-100 hover:bg-red-200 dark:bg-red-800 dark:hover:bg-red-700 text-red-800 dark:text-red-200 text-xs font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900",children:[r.jsx(l,{className:"h-3 w-3 mr-1"}),"Retry"]}),r.jsxs("button",{onClick:this.toggleDetails,className:"inline-flex items-center px-3 py-1.5 bg-red-100 hover:bg-red-200 dark:bg-red-800 dark:hover:bg-red-700 text-red-800 dark:text-red-200 text-xs font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900",children:[this.state.showDetails?"Hide":"Show"," Details"]})]}),this.state.showDetails&&this.state.error&&r.jsxs("div",{className:"mt-3 p-2 bg-red-100 dark:bg-red-900/40 rounded text-xs font-mono text-red-800 dark:text-red-300 overflow-auto max-h-32",children:[r.jsx("div",{className:"font-semibold mb-1",children:this.state.error.name}),r.jsx("div",{className:"mb-2",children:this.state.error.message}),this.state.error.stack&&r.jsx("div",{className:"text-red-600 dark:text-red-400 whitespace-pre-wrap",children:this.state.error.stack.split(`
`).slice(0,5).join(`
`)})]})]}),r.jsx("button",{onClick:this.handleRetry,className:"ml-2 text-red-400 hover:text-red-600 dark:hover:text-red-300 transition-colors","aria-label":"Dismiss error",children:r.jsx(c,{className:"h-4 w-4"})})]})})}):this.props.children}}export{v as default};
